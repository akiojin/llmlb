var qs=s=>{throw TypeError(s)};var ps=(s,t,a)=>t.has(s)||qs("Cannot "+a);var I=(s,t,a)=>(ps(s,t,"read from private field"),a?a.call(s):t.get(s)),we=(s,t,a)=>t.has(s)?qs("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,a),Ce=(s,t,a,n)=>(ps(s,t,"write to private field"),n?n.call(s,a):t.set(s,a),a),ke=(s,t,a)=>(ps(s,t,"access private method"),a);import{r,i as $s,a as js,b as Ht,j as e,c as M,g as Bt,d as _s,P as Us,e as Ne,u as Hs,f as os,h as _e,k as Gt,l as E,m as Vt,n as Bs,B as b,o as ue,L as F,I as H,t as A,p as gs,U as Gs,q as es,s as fs,C as As,v as K,w as vs,x as ws,y as Ae,z as Re,A as Se,D as Qt,T as Wt,E as Zt}from"./index-jflA8gJe.js";import{S as Jt,s as Xt,h as Fs,g as Yt,n as Vs,u as me,a as ea,b as sa,c as ta,C as he,d as Qs,O as aa,P as ra,W as na,e as ia,T as la,D as ca,f as Ws,R as oa,i as da,j as le,k as se,l as te,m as ae,o as re,p as ne,q as ds,r as be,t as $e,v as Te,B as _,w as Be,x as fe,y as De,z as Ee,A as Ie,E as qe,F as q,M as rs,G as ua,H as ha,I as ma,J as xa,K as pa,L as ja,N as ys,Q as Oe,U as Ps,V as ga,X as Zs,Y as fa,Z as va,_ as Js,$ as ya,a0 as Na,a1 as ba,a2 as wa,a3 as Ca,a4 as ka,a5 as Sa}from"./switch-D_Wl9JQ8.js";import{T as Cs,C as ns}from"./ticket-CPoFR2Wv.js";import{C as Y,a as ee,b as ve,c as ye}from"./card-C8DwBdsg.js";var ce,je,B,oe,de,ts,ks,zs,_a=(zs=class extends Jt{constructor(t,a){super();we(this,de);we(this,ce);we(this,je);we(this,B);we(this,oe);Ce(this,ce,t),this.setOptions(a),this.bindMethods(),ke(this,de,ts).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const a=this.options;this.options=I(this,ce).defaultMutationOptions(t),Xt(this.options,a)||I(this,ce).getMutationCache().notify({type:"observerOptionsUpdated",mutation:I(this,B),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&Fs(a.mutationKey)!==Fs(this.options.mutationKey)?this.reset():((n=I(this,B))==null?void 0:n.state.status)==="pending"&&I(this,B).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=I(this,B))==null||t.removeObserver(this)}onMutationUpdate(t){ke(this,de,ts).call(this),ke(this,de,ks).call(this,t)}getCurrentResult(){return I(this,je)}reset(){var t;(t=I(this,B))==null||t.removeObserver(this),Ce(this,B,void 0),ke(this,de,ts).call(this),ke(this,de,ks).call(this)}mutate(t,a){var n;return Ce(this,oe,a),(n=I(this,B))==null||n.removeObserver(this),Ce(this,B,I(this,ce).getMutationCache().build(I(this,ce),this.options)),I(this,B).addObserver(this),I(this,B).execute(t)}},ce=new WeakMap,je=new WeakMap,B=new WeakMap,oe=new WeakMap,de=new WeakSet,ts=function(){var a;const t=((a=I(this,B))==null?void 0:a.state)??Yt();Ce(this,je,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},ks=function(t){Vs.batch(()=>{var a,n,i,l,c,h,j,o;if(I(this,oe)&&this.hasListeners()){const d=I(this,je).variables,p=I(this,je).context,g={client:I(this,ce),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((n=(a=I(this,oe)).onSuccess)==null||n.call(a,t.data,d,p,g),(l=(i=I(this,oe)).onSettled)==null||l.call(i,t.data,null,d,p,g)):(t==null?void 0:t.type)==="error"&&((h=(c=I(this,oe)).onError)==null||h.call(c,t.error,d,p,g),(o=(j=I(this,oe)).onSettled)==null||o.call(j,void 0,t.error,d,p,g))}this.listeners.forEach(d=>{d(I(this,je))})})},zs);function G(s,t){const a=me(),[n]=r.useState(()=>new _a(a,s));r.useEffect(()=>{n.setOptions(s)},[n,s]);const i=r.useSyncExternalStore(r.useCallback(c=>n.subscribe(Vs.batchCalls(c)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),l=r.useCallback((c,h)=>{n.mutate(c,h).catch(ea)},[n]);if(i.error&&sa(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:l,mutateAsync:i.mutate}}const Xs=r.createContext(null);function Aa({children:s}){const[t,a]=r.useState(null),[n,i]=r.useState(!0),l=r.useCallback(async()=>{if(!$s()){a(null),i(!1);return}try{const j=await js.me();a(j)}catch{Ht(),a(null)}finally{i(!1)}},[]),c=r.useCallback(async(j,o)=>{await js.login(j,o),await l()},[l]),h=r.useCallback(async()=>{await js.logout(),a(null),window.location.href="/dashboard/login.html"},[]);return r.useEffect(()=>{l()},[l]),e.jsx(Xs.Provider,{value:{user:t,isLoading:n,isLoggedIn:!!t,login:c,logout:h,checkAuth:l},children:s})}function Rs(){const s=r.useContext(Xs);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s}/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=M("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=M("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=M("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=M("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=M("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=M("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=M("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=M("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=M("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=M("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=M("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=M("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=M("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=M("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=M("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=M("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=M("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=M("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=M("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=M("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=M("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=M("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=M("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=M("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=M("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=M("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=M("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=M("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=M("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=M("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=M("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=M("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=M("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function Ga(s={}){const{onMessage:t,onConnect:a,onDisconnect:n,reconnectInterval:i=3e3}=s,l=me(),c=r.useRef(null),h=r.useRef(null),[j,o]=r.useState(!1),[d,p]=r.useState(null),g=r.useCallback(()=>{const f=Bt();if(!f){console.warn("No JWT token available for WebSocket connection"),h.current=setTimeout(g,i);return}const S=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/dashboard?token=${encodeURIComponent(f)}`;try{const k=new WebSocket(S);c.current=k,k.onopen=()=>{o(!0),a==null||a()},k.onmessage=x=>{try{const R=JSON.parse(x.data);switch(p(R),t==null||t(R),R.type){case"NodeRegistered":case"NodeRemoved":case"NodeStatusChanged":l.invalidateQueries({queryKey:["dashboard-overview"]}),l.invalidateQueries({queryKey:["request-responses"]});break;case"MetricsUpdated":l.invalidateQueries({queryKey:["dashboard-overview"]});break}}catch(R){console.error("Failed to parse WebSocket message:",R)}},k.onclose=()=>{o(!1),n==null||n(),c.current=null,h.current&&clearTimeout(h.current),h.current=setTimeout(g,i)},k.onerror=x=>{console.error("WebSocket error:",x),k.close()}}catch(k){console.error("Failed to create WebSocket:",k),h.current=setTimeout(g,i)}},[t,a,n,i,l]),C=r.useCallback(()=>{h.current&&(clearTimeout(h.current),h.current=null),c.current&&(c.current.close(),c.current=null),o(!1)},[]);return r.useEffect(()=>(g(),()=>{C()}),[g,C]),{isConnected:j,lastEvent:d,reconnect:g,disconnect:C}}function Va(){const{isConnected:s,lastEvent:t,reconnect:a}=Ga({onConnect:()=>{console.log("Dashboard WebSocket connected")},onDisconnect:()=>{console.log("Dashboard WebSocket disconnected")}});return{isConnected:s,lastEvent:t,reconnect:a}}const Ns="llm-router-theme";function Qa(){const[s,t]=r.useState(()=>{if(typeof window>"u")return"dark";const n=localStorage.getItem(Ns);return n==="light"||n==="dark"?n:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"});r.useEffect(()=>{document.documentElement.classList.toggle("dark",s==="dark"),localStorage.setItem(Ns,s)},[s]),r.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)"),i=l=>{localStorage.getItem(Ns)||t(l.matches?"dark":"light")};return n.addEventListener("change",i),()=>n.removeEventListener("change",i)},[]);const a=r.useCallback(()=>{t(n=>n==="dark"?"light":"dark")},[]);return{theme:s,setTheme:t,toggleTheme:a}}var us="Checkbox",[Wa]=_s(us),[Za,Ts]=Wa(us);function Ja(s){const{__scopeCheckbox:t,checked:a,children:n,defaultChecked:i,disabled:l,form:c,name:h,onCheckedChange:j,required:o,value:d="on",internal_do_not_use_render:p}=s,[g,C]=Hs({prop:a,defaultProp:i??!1,onChange:j,caller:us}),[f,v]=r.useState(null),[S,k]=r.useState(null),x=r.useRef(!1),R=f?!!c||!!f.closest("form"):!0,P={checked:g,disabled:l,setChecked:C,control:f,setControl:v,name:h,form:c,value:d,hasConsumerStoppedPropagationRef:x,required:o,defaultChecked:ge(i)?!1:i,isFormControl:R,bubbleInput:S,setBubbleInput:k};return e.jsx(Za,{scope:t,...P,children:Xa(p)?p(P):n})}var rt="CheckboxTrigger",nt=r.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...n},i)=>{const{control:l,value:c,disabled:h,checked:j,required:o,setControl:d,setChecked:p,hasConsumerStoppedPropagationRef:g,isFormControl:C,bubbleInput:f}=Ts(rt,s),v=os(i,d),S=r.useRef(j);return r.useEffect(()=>{const k=l==null?void 0:l.form;if(k){const x=()=>p(S.current);return k.addEventListener("reset",x),()=>k.removeEventListener("reset",x)}},[l,p]),e.jsx(Ne.button,{type:"button",role:"checkbox","aria-checked":ge(j)?"mixed":j,"aria-required":o,"data-state":dt(j),"data-disabled":h?"":void 0,disabled:h,value:c,...n,ref:v,onKeyDown:_e(t,k=>{k.key==="Enter"&&k.preventDefault()}),onClick:_e(a,k=>{p(x=>ge(x)?!0:!x),f&&C&&(g.current=k.isPropagationStopped(),g.current||k.stopPropagation())})})});nt.displayName=rt;var Ds=r.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:n,checked:i,defaultChecked:l,required:c,disabled:h,value:j,onCheckedChange:o,form:d,...p}=s;return e.jsx(Ja,{__scopeCheckbox:a,checked:i,defaultChecked:l,disabled:h,required:c,onCheckedChange:o,name:n,form:d,value:j,internal_do_not_use_render:({isFormControl:g})=>e.jsxs(e.Fragment,{children:[e.jsx(nt,{...p,ref:t,__scopeCheckbox:a}),g&&e.jsx(ot,{__scopeCheckbox:a})]})})});Ds.displayName=us;var it="CheckboxIndicator",lt=r.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:n,...i}=s,l=Ts(it,a);return e.jsx(Us,{present:n||ge(l.checked)||l.checked===!0,children:e.jsx(Ne.span,{"data-state":dt(l.checked),"data-disabled":l.disabled?"":void 0,...i,ref:t,style:{pointerEvents:"none",...s.style}})})});lt.displayName=it;var ct="CheckboxBubbleInput",ot=r.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:n,hasConsumerStoppedPropagationRef:i,checked:l,defaultChecked:c,required:h,disabled:j,name:o,value:d,form:p,bubbleInput:g,setBubbleInput:C}=Ts(ct,s),f=os(a,C),v=ta(l),S=Gt(n);r.useEffect(()=>{const x=g;if(!x)return;const R=window.HTMLInputElement.prototype,O=Object.getOwnPropertyDescriptor(R,"checked").set,z=!i.current;if(v!==l&&O){const y=new Event("click",{bubbles:z});x.indeterminate=ge(l),O.call(x,ge(l)?!1:l),x.dispatchEvent(y)}},[g,v,l,i]);const k=r.useRef(ge(l)?!1:l);return e.jsx(Ne.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??k.current,required:h,disabled:j,name:o,value:d,form:p,...t,tabIndex:-1,ref:f,style:{...t.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ot.displayName=ct;function Xa(s){return typeof s=="function"}function ge(s){return s==="indeterminate"}function dt(s){return ge(s)?"indeterminate":s?"checked":"unchecked"}const ut=r.forwardRef(({className:s,...t},a)=>e.jsx(Ds,{ref:a,className:E("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:e.jsx(lt,{className:E("flex items-center justify-center text-current"),children:e.jsx(he,{className:"h-4 w-4"})})}));ut.displayName=Ds.displayName;const Fe=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:E("w-full caption-bottom text-sm",s),...t})}));Fe.displayName="Table";const Pe=r.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:E("[&_tr]:border-b",s),...t}));Pe.displayName="TableHeader";const Le=r.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:E("[&_tr:last-child]:border-0",s),...t}));Le.displayName="TableBody";const Ya=r.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:E("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Ya.displayName="TableFooter";const W=r.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:E("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));W.displayName="TableRow";const D=r.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:E("h-11 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));D.displayName="TableHead";const T=r.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:E("p-4 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));T.displayName="TableCell";const er=r.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:E("mt-4 text-sm text-muted-foreground",s),...t}));er.displayName="TableCaption";var ht="AlertDialog",[sr]=_s(ht,[Qs]),xe=Qs(),mt=s=>{const{__scopeAlertDialog:t,...a}=s,n=xe(t);return e.jsx(oa,{...n,...a,modal:!0})};mt.displayName=ht;var tr="AlertDialogTrigger",ar=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...n}=s,i=xe(a);return e.jsx(da,{...i,...n,ref:t})});ar.displayName=tr;var rr="AlertDialogPortal",xt=s=>{const{__scopeAlertDialog:t,...a}=s,n=xe(t);return e.jsx(ra,{...n,...a})};xt.displayName=rr;var nr="AlertDialogOverlay",pt=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...n}=s,i=xe(a);return e.jsx(aa,{...i,...n,ref:t})});pt.displayName=nr;var Me="AlertDialogContent",[ir,lr]=sr(Me),cr=Vt("AlertDialogContent"),jt=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,children:n,...i}=s,l=xe(a),c=r.useRef(null),h=os(t,c),j=r.useRef(null);return e.jsx(na,{contentName:Me,titleName:gt,docsSlug:"alert-dialog",children:e.jsx(ir,{scope:a,cancelRef:j,children:e.jsxs(ia,{role:"alertdialog",...l,...i,ref:h,onOpenAutoFocus:_e(i.onOpenAutoFocus,o=>{var d;o.preventDefault(),(d=j.current)==null||d.focus({preventScroll:!0})}),onPointerDownOutside:o=>o.preventDefault(),onInteractOutside:o=>o.preventDefault(),children:[e.jsx(cr,{children:n}),e.jsx(dr,{contentRef:c})]})})})});jt.displayName=Me;var gt="AlertDialogTitle",ft=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...n}=s,i=xe(a);return e.jsx(la,{...i,...n,ref:t})});ft.displayName=gt;var vt="AlertDialogDescription",yt=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...n}=s,i=xe(a);return e.jsx(ca,{...i,...n,ref:t})});yt.displayName=vt;var or="AlertDialogAction",Nt=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...n}=s,i=xe(a);return e.jsx(Ws,{...i,...n,ref:t})});Nt.displayName=or;var bt="AlertDialogCancel",wt=r.forwardRef((s,t)=>{const{__scopeAlertDialog:a,...n}=s,{cancelRef:i}=lr(bt,a),l=xe(a),c=os(t,i);return e.jsx(Ws,{...l,...n,ref:c})});wt.displayName=bt;var dr=({contentRef:s})=>{const t=`\`${Me}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Me}\` by passing a \`${vt}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Me}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return r.useEffect(()=>{var n;document.getElementById((n=s.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,s]),null},ur=mt,hr=xt,Ct=pt,kt=jt,St=Nt,_t=wt,At=ft,Rt=yt;const hs=ur,mr=hr,Mt=r.forwardRef(({className:s,...t},a)=>e.jsx(Ct,{className:E("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Mt.displayName=Ct.displayName;const Ge=r.forwardRef(({className:s,...t},a)=>e.jsxs(mr,{children:[e.jsx(Mt,{}),e.jsx(kt,{ref:a,className:E("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Ge.displayName=kt.displayName;const Ve=({className:s,...t})=>e.jsx("div",{className:E("flex flex-col space-y-2 text-center sm:text-left",s),...t});Ve.displayName="AlertDialogHeader";const Qe=({className:s,...t})=>e.jsx("div",{className:E("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Qe.displayName="AlertDialogFooter";const We=r.forwardRef(({className:s,...t},a)=>e.jsx(At,{ref:a,className:E("text-lg font-semibold",s),...t}));We.displayName=At.displayName;const Ze=r.forwardRef(({className:s,...t},a)=>e.jsx(Rt,{ref:a,className:E("text-sm text-muted-foreground",s),...t}));Ze.displayName=Rt.displayName;const Je=r.forwardRef(({className:s,...t},a)=>e.jsx(St,{ref:a,className:E(Bs(),s),...t}));Je.displayName=St.displayName;const Xe=r.forwardRef(({className:s,...t},a)=>e.jsx(_t,{ref:a,className:E(Bs({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Xe.displayName=_t.displayName;function xr({open:s,onOpenChange:t}){const a=me(),[n,i]=r.useState(!1),[l,c]=r.useState(null),[h,j]=r.useState(""),[o,d]=r.useState(""),[p,g]=r.useState(["api"]),[C,f]=r.useState(null),[v,S]=r.useState(null),[k,x]=r.useState(null),{data:R,isLoading:P,refetch:O}=le({queryKey:["api-keys"],queryFn:gs.list,enabled:s}),z=G({mutationFn:N=>gs.create(N),onSuccess:N=>{a.invalidateQueries({queryKey:["api-keys"]}),f(N.key),j(""),d(""),g(["api"]),A({title:"API key created"})},onError:N=>{A({title:"Failed to create API key",description:N instanceof Error?N.message:"Unknown error",variant:"destructive"})}}),y=G({mutationFn:N=>gs.delete(N),onSuccess:()=>{a.invalidateQueries({queryKey:["api-keys"]}),c(null),A({title:"API key deleted"})},onError:N=>{A({title:"Failed to delete API key",description:N instanceof Error?N.message:"Unknown error",variant:"destructive"})}});r.useEffect(()=>{s||(f(null),S(null))},[s]),r.useEffect(()=>{n||(j(""),d(""),g(["api"]))},[n]);const Z=async(N,L)=>{try{await navigator.clipboard.writeText(N),x(L),setTimeout(()=>x(null),2e3),A({title:"Copied to clipboard"})}catch{A({title:"Failed to copy",variant:"destructive"})}},w=()=>{z.mutate({name:h,expires_at:o||void 0,scopes:p})},V=N=>N?new Date(N)<new Date:!1,J=(N,L)=>{g(u=>L?u.includes(N)?u:[...u,N]:u.filter(m=>m!==N))},pe=[{value:"api",label:"api",description:"OpenAI互換APIの推論アクセス"},{value:"node",label:"node",description:"ノード登録・同期"},{value:"admin",label:"admin",description:"管理者（全権限）"}];return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:s,onOpenChange:t,children:e.jsxs(te,{id:"api-keys-modal",className:"max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5"}),"API Keys"]}),e.jsx(ne,{children:"Manage your API keys for programmatic access."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{id:"create-api-key",onClick:()=>i(!0),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Create Key"]}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>O(),children:e.jsx(be,{className:"h-4 w-4"})})]}),C&&e.jsxs("div",{className:"rounded-lg border border-success/50 bg-success/10 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-success mb-2",children:"API Key Created Successfully"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Copy this key now. You won't be able to see it again."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 rounded bg-muted px-2 py-1 text-xs font-mono break-all",children:v==="created"?C:"•".repeat(32)}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>S(v==="created"?null:"created"),children:v==="created"?e.jsx(Ea,{className:"h-4 w-4"}):e.jsx(Ia,{className:"h-4 w-4"})}),e.jsx(b,{id:"copy-api-key",variant:"ghost",size:"icon",onClick:()=>Z(C,"created"),children:k==="created"?e.jsx(he,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})})]})]}),e.jsx(Te,{className:"h-64 rounded-md border",children:P?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(Q,{className:"h-6 w-6 animate-spin"})}):!R||R.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(cs,{className:"h-8 w-8"}),e.jsx("p",{children:"No API keys"})]}):e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(W,{children:[e.jsx(D,{children:"Name"}),e.jsx(D,{children:"Scopes"}),e.jsx(D,{children:"Key"}),e.jsx(D,{children:"Created"}),e.jsx(D,{children:"Expires"}),e.jsx(D,{className:"text-right",children:"Actions"})]})}),e.jsx(Le,{children:R.map(N=>e.jsxs(W,{children:[e.jsx(T,{className:"font-medium",children:N.name}),e.jsx(T,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:N.scopes.map(L=>e.jsx(_,{variant:"secondary",children:L},L))})}),e.jsx(T,{children:N.key_prefix?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("code",{className:"text-xs font-mono",children:[N.key_prefix,"..."]}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>Z(N.key_prefix,N.id),children:k===N.id?e.jsx(he,{className:"h-3 w-3"}):e.jsx($e,{className:"h-3 w-3"})})]}):e.jsxs("span",{className:"text-xs text-muted-foreground",children:[N.id.slice(0,8),"..."]})}),e.jsx(T,{className:"text-sm text-muted-foreground",children:ue(N.created_at)}),e.jsx(T,{children:N.expires_at?e.jsx(_,{variant:V(N.expires_at)?"destructive":"outline",children:V(N.expires_at)?"Expired":ue(N.expires_at)}):e.jsx(_,{variant:"secondary",children:"Never"})}),e.jsx(T,{className:"text-right",children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>c(N),children:e.jsx(Be,{className:"h-4 w-4 text-destructive"})})})]},N.id))})]})})]})]})}),e.jsx(se,{open:n,onOpenChange:i,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Create API Key"}),e.jsx(ne,{children:"Create a new API key for programmatic access."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"api-key-name",children:"Name"}),e.jsx(H,{id:"api-key-name",placeholder:"My API Key",value:h,onChange:N=>j(N.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"key-expires",children:"Expires (optional)"}),e.jsx(H,{id:"key-expires",type:"datetime-local",value:o,onChange:N=>d(N.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Scopes"}),e.jsx("div",{className:"grid gap-2",children:pe.map(N=>{const L=`scope-${N.value.replace(/[^a-z0-9]/gi,"-")}`;return e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ut,{id:L,checked:p.includes(N.value),onCheckedChange:u=>J(N.value,!!u)}),e.jsxs("label",{htmlFor:L,className:"flex flex-col gap-1 cursor-pointer",children:[e.jsx("span",{className:"font-mono text-xs",children:N.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:N.description})]})]},N.value)})})]})]}),e.jsxs(fe,{children:[e.jsx(b,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(b,{onClick:w,disabled:!h||p.length===0||z.isPending,children:[z.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Create"]})]})]})}),e.jsx(hs,{open:!!l,onOpenChange:()=>c(null),children:e.jsxs(Ge,{children:[e.jsxs(Ve,{children:[e.jsx(We,{children:"Delete API Key"}),e.jsxs(Ze,{children:['Are you sure you want to delete "',l==null?void 0:l.name,'"? This action cannot be undone.']})]}),e.jsxs(Qe,{children:[e.jsx(Xe,{children:"Cancel"}),e.jsxs(Je,{onClick:()=>l&&y.mutate(l.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[y.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete"]})]})]})})]})}function pr({open:s,onOpenChange:t}){const a=me(),[n,i]=r.useState(!1),[l,c]=r.useState(null),[h,j]=r.useState(null),[o,d]=r.useState(""),[p,g]=r.useState(""),[C,f]=r.useState("user"),{data:v,isLoading:S,refetch:k}=le({queryKey:["users"],queryFn:es.list,enabled:s}),x=G({mutationFn:w=>es.create(w),onSuccess:()=>{a.invalidateQueries({queryKey:["users"]}),O(),i(!1),A({title:"User created"})},onError:w=>{A({title:"Failed to create user",description:w instanceof Error?w.message:"Unknown error",variant:"destructive"})}}),R=G({mutationFn:({id:w,data:V})=>es.update(w,V),onSuccess:()=>{a.invalidateQueries({queryKey:["users"]}),O(),c(null),A({title:"User updated"})},onError:w=>{A({title:"Failed to update user",description:w instanceof Error?w.message:"Unknown error",variant:"destructive"})}}),P=G({mutationFn:w=>es.delete(w),onSuccess:()=>{a.invalidateQueries({queryKey:["users"]}),j(null),A({title:"User deleted"})},onError:w=>{A({title:"Failed to delete user",description:w instanceof Error?w.message:"Unknown error",variant:"destructive"})}}),O=()=>{d(""),g(""),f("user")};r.useEffect(()=>{l?(d(l.username),g(""),f(l.role)):O()},[l]);const z=()=>{x.mutate({username:o,password:p,role:C})},y=()=>{if(!l)return;const w={};o!==l.username&&(w.username=o),p&&(w.password=p),C!==l.role&&(w.role=C),R.mutate({id:l.id,data:w})},Z=w=>w==="admin"?e.jsxs(_,{variant:"default",className:"gap-1",children:[e.jsx(Ka,{className:"h-3 w-3"}),"Admin"]}):e.jsxs(_,{variant:"secondary",className:"gap-1",children:[e.jsx(Gs,{className:"h-3 w-3"}),"User"]});return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:s,onOpenChange:t,children:e.jsxs(te,{className:"max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"h-5 w-5"}),"User Management"]}),e.jsx(ne,{children:"Manage dashboard users and their permissions."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{onClick:()=>i(!0),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Add User"]}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>k(),children:e.jsx(be,{className:"h-4 w-4"})})]}),e.jsx(Te,{className:"h-64 rounded-md border",children:S?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(Q,{className:"h-6 w-6 animate-spin"})}):!v||v.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(Ss,{className:"h-8 w-8"}),e.jsx("p",{children:"No users"})]}):e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(W,{children:[e.jsx(D,{children:"Username"}),e.jsx(D,{children:"Role"}),e.jsx(D,{children:"Created"}),e.jsx(D,{className:"text-right",children:"Actions"})]})}),e.jsx(Le,{children:v.map(w=>e.jsxs(W,{children:[e.jsx(T,{className:"font-medium",children:w.username}),e.jsx(T,{children:Z(w.role)}),e.jsx(T,{className:"text-sm text-muted-foreground",children:ue(w.created_at)}),e.jsx(T,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>c(w),children:e.jsx(za,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>j(w),children:e.jsx(Be,{className:"h-4 w-4 text-destructive"})})]})})]},w.id))})]})})]})]})}),e.jsx(se,{open:n,onOpenChange:i,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Create User"}),e.jsx(ne,{children:"Add a new dashboard user."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-username",children:"Username"}),e.jsx(H,{id:"create-username",placeholder:"johndoe",value:o,onChange:w=>d(w.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-password",children:"Password"}),e.jsx(H,{id:"create-password",type:"password",placeholder:"••••••••",value:p,onChange:w=>g(w.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-role",children:"Role"}),e.jsxs(De,{value:C,onValueChange:w=>f(w),children:[e.jsx(Ee,{children:e.jsx(Ie,{})}),e.jsxs(qe,{children:[e.jsx(q,{value:"user",children:"User"}),e.jsx(q,{value:"admin",children:"Admin"})]})]})]})]}),e.jsxs(fe,{children:[e.jsx(b,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(b,{onClick:z,disabled:!o||!p||x.isPending,children:[x.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Create"]})]})]})}),e.jsx(se,{open:!!l,onOpenChange:()=>c(null),children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Edit User"}),e.jsxs(ne,{children:['Update user "',l==null?void 0:l.username,'".']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"edit-username",children:"Username"}),e.jsx(H,{id:"edit-username",value:o,onChange:w=>d(w.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"edit-password",children:"Password (leave blank to keep)"}),e.jsx(H,{id:"edit-password",type:"password",placeholder:"••••••••",value:p,onChange:w=>g(w.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"edit-role",children:"Role"}),e.jsxs(De,{value:C,onValueChange:w=>f(w),children:[e.jsx(Ee,{children:e.jsx(Ie,{})}),e.jsxs(qe,{children:[e.jsx(q,{value:"user",children:"User"}),e.jsx(q,{value:"admin",children:"Admin"})]})]})]})]}),e.jsxs(fe,{children:[e.jsx(b,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),e.jsxs(b,{onClick:y,disabled:!o||R.isPending,children:[R.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Update"]})]})]})}),e.jsx(hs,{open:!!h,onOpenChange:()=>j(null),children:e.jsxs(Ge,{children:[e.jsxs(Ve,{children:[e.jsx(We,{children:"Delete User"}),e.jsxs(Ze,{children:['Are you sure you want to delete "',h==null?void 0:h.username,'"? This action cannot be undone.']})]}),e.jsxs(Qe,{children:[e.jsx(Xe,{children:"Cancel"}),e.jsxs(Je,{onClick:()=>h&&P.mutate(h.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[P.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete"]})]})]})})]})}function jr({open:s,onOpenChange:t}){const a=me(),[n,i]=r.useState(!1),[l,c]=r.useState(72),[h,j]=r.useState(null),[o,d]=r.useState(null),[p,g]=r.useState(!1),{data:C,isLoading:f,refetch:v}=le({queryKey:["invitations"],queryFn:fs.list,enabled:s}),S=G({mutationFn:y=>fs.create(y),onSuccess:y=>{a.invalidateQueries({queryKey:["invitations"]}),d(y),A({title:"Invitation code created"})},onError:y=>{A({title:"Failed to create invitation code",description:y instanceof Error?y.message:"Unknown error",variant:"destructive"})}}),k=G({mutationFn:y=>fs.revoke(y),onSuccess:()=>{a.invalidateQueries({queryKey:["invitations"]}),j(null),A({title:"Invitation code revoked"})},onError:y=>{A({title:"Failed to revoke invitation code",description:y instanceof Error?y.message:"Unknown error",variant:"destructive"})}}),x=()=>{S.mutate(l)},R=async()=>{o!=null&&o.code&&(await navigator.clipboard.writeText(o.code),g(!0),setTimeout(()=>g(!1),2e3))},P=()=>{d(null),i(!1),g(!1)},O=y=>{switch(y){case"active":return e.jsxs(_,{variant:"default",className:"gap-1 bg-green-600",children:[e.jsx(Ue,{className:"h-3 w-3"}),"Active"]});case"used":return e.jsxs(_,{variant:"secondary",className:"gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),"Used"]});case"revoked":return e.jsxs(_,{variant:"destructive",className:"gap-1",children:[e.jsx(is,{className:"h-3 w-3"}),"Revoked"]});default:return e.jsx(_,{variant:"outline",children:y})}},z=y=>new Date(y)<new Date;return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:s,onOpenChange:t,children:e.jsxs(te,{className:"max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"Invitation Codes"]}),e.jsx(ne,{children:"Create and manage invitation codes for user registration."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{onClick:()=>i(!0),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Create Code"]}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>v(),children:e.jsx(be,{className:"h-4 w-4"})})]}),e.jsx(Te,{className:"h-80 rounded-md border",children:f?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(Q,{className:"h-6 w-6 animate-spin"})}):!C||C.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(Cs,{className:"h-8 w-8"}),e.jsx("p",{children:"No invitation codes"})]}):e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(W,{children:[e.jsx(D,{children:"ID"}),e.jsx(D,{children:"Status"}),e.jsx(D,{children:"Created"}),e.jsx(D,{children:"Expires"}),e.jsx(D,{children:"Used By"}),e.jsx(D,{className:"text-right",children:"Actions"})]})}),e.jsx(Le,{children:C.map(y=>e.jsxs(W,{children:[e.jsxs(T,{className:"font-mono text-xs",children:[y.id.slice(0,8),"..."]}),e.jsx(T,{children:y.status==="active"&&z(y.expires_at)?e.jsxs(_,{variant:"outline",className:"gap-1",children:[e.jsx(is,{className:"h-3 w-3"}),"Expired"]}):O(y.status)}),e.jsx(T,{className:"text-sm text-muted-foreground",children:ue(y.created_at)}),e.jsx(T,{className:"text-sm text-muted-foreground",children:ue(y.expires_at)}),e.jsx(T,{className:"font-mono text-xs text-muted-foreground",children:y.used_by?`${y.used_by.slice(0,8)}...`:"-"}),e.jsx(T,{className:"text-right",children:y.status==="active"&&!z(y.expires_at)&&e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>j(y),children:e.jsx(Ma,{className:"h-4 w-4 text-destructive"})})})]},y.id))})]})})]})]})}),e.jsx(se,{open:n&&!o,onOpenChange:y=>!y&&i(!1),children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Create Invitation Code"}),e.jsx(ne,{children:"Generate a new invitation code for user registration."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"expires-in",children:"Expires In"}),e.jsxs(De,{value:String(l),onValueChange:y=>c(Number(y)),children:[e.jsx(Ee,{children:e.jsx(Ie,{})}),e.jsxs(qe,{children:[e.jsx(q,{value:"24",children:"24 hours (1 day)"}),e.jsx(q,{value:"48",children:"48 hours (2 days)"}),e.jsx(q,{value:"72",children:"72 hours (3 days)"}),e.jsx(q,{value:"168",children:"168 hours (1 week)"}),e.jsx(q,{value:"720",children:"720 hours (30 days)"})]})]})]})}),e.jsxs(fe,{children:[e.jsx(b,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(b,{onClick:x,disabled:S.isPending,children:[S.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Create"]})]})]})}),e.jsx(se,{open:!!o,onOpenChange:P,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ns,{className:"h-5 w-5"}),"Invitation Code Created"]}),e.jsx(ne,{children:"Copy this code and share it with the user. This code will only be shown once."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Invitation Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 rounded-md bg-muted px-4 py-3 font-mono text-sm break-all",children:o==null?void 0:o.code}),e.jsx(b,{variant:"outline",size:"icon",onClick:R,className:"shrink-0",children:p?e.jsx(he,{className:"h-4 w-4 text-green-600"}):e.jsx($e,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsxs("p",{children:["Expires: ",o&&new Date(o.expires_at).toLocaleString()]})})]}),e.jsx(fe,{children:e.jsx(b,{onClick:P,children:"Done"})})]})}),e.jsx(hs,{open:!!h,onOpenChange:()=>j(null),children:e.jsxs(Ge,{children:[e.jsxs(Ve,{children:[e.jsx(We,{children:"Revoke Invitation Code"}),e.jsx(Ze,{children:"Are you sure you want to revoke this invitation code? It will no longer be usable for registration."})]}),e.jsxs(Qe,{children:[e.jsx(Xe,{children:"Cancel"}),e.jsxs(Je,{onClick:()=>h&&k.mutate(h.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[k.isPending&&e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}),"Revoke"]})]})]})})]})}function gr({user:s,isConnected:t=!0,lastRefreshed:a,fetchTimeMs:n}){const{logout:i}=Rs(),{theme:l,toggleTheme:c}=Qa(),[h,j]=r.useState(!1),[o,d]=r.useState(!1),[p,g]=r.useState(!1),[C,f]=r.useState(!1),v=()=>{f(!0),window.location.reload()},S=()=>{window.open("/dashboard/playground.html","_blank")};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-border/50 bg-background/80 backdrop-blur-xl",children:e.jsxs("div",{className:"mx-auto flex h-16 max-w-[1600px] items-center justify-between px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10 glow-sm",children:e.jsx(As,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-lg font-semibold tracking-tight",children:"LLM Router"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dashboard"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{id:"connection-status",className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`h-2 w-2 rounded-full ${t?"bg-green-500":"bg-red-500"}`}),"Connection: ",t?"Online":"Offline"]}),a&&e.jsxs("span",{id:"last-refreshed",children:["Last updated: ",a.toLocaleTimeString()]}),!a&&e.jsx("span",{id:"last-refreshed",children:"Last updated: --:--:--"}),n!=null&&e.jsxs("span",{id:"refresh-metrics",children:["Fetch time: ",n,"ms"]}),n==null&&e.jsx("span",{id:"refresh-metrics",children:"Fetch time: --ms"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{id:"chat-open",variant:"outline",size:"sm",onClick:S,className:"hidden sm:inline-flex",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Playground"]}),e.jsxs(b,{id:"api-keys-button",variant:"outline",size:"sm",onClick:()=>j(!0),className:"hidden sm:inline-flex",children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"API Keys"]}),e.jsx(b,{id:"refresh-button",variant:"ghost",size:"icon",onClick:v,disabled:C,children:e.jsx(be,{className:`h-4 w-4 ${C?"animate-spin":""}`})}),e.jsx(b,{id:"theme-toggle",variant:"ghost",size:"icon",onClick:c,children:l==="dark"?e.jsx(ua,{className:"h-4 w-4"}):e.jsx(ha,{className:"h-4 w-4"})}),e.jsxs(ma,{children:[e.jsx(xa,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"relative",children:e.jsx(Gs,{className:"h-4 w-4"})})}),e.jsxs(pa,{align:"end",className:"w-56",children:[e.jsx(ja,{children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s==null?void 0:s.username}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:s==null?void 0:s.role})]})}),e.jsx(ys,{}),e.jsxs(Oe,{onClick:S,className:"sm:hidden",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Playground"]}),e.jsxs(Oe,{onClick:()=>j(!0),className:"sm:hidden",children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"API Keys"]}),e.jsx(ys,{className:"sm:hidden"}),(s==null?void 0:s.role)==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{onClick:()=>d(!0),children:[e.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Manage Users"]}),e.jsxs(Oe,{onClick:()=>g(!0),children:[e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Invitation Codes"]}),e.jsx(ys,{})]}),e.jsxs(Oe,{onClick:i,className:"text-destructive",children:[e.jsx(La,{className:"mr-2 h-4 w-4"}),"Sign out"]})]})]})]})]})}),e.jsx(xr,{open:h,onOpenChange:j}),e.jsx(pr,{open:o,onOpenChange:d}),e.jsx(jr,{open:p,onOpenChange:g})]})}const Ls={primary:"bg-primary/10 group-hover:bg-primary/20","chart-1":"bg-chart-1/10 group-hover:bg-chart-1/20","chart-2":"bg-chart-2/10 group-hover:bg-chart-2/20","chart-3":"bg-chart-3/10 group-hover:bg-chart-3/20","chart-4":"bg-chart-4/10 group-hover:bg-chart-4/20","chart-5":"bg-chart-5/10 group-hover:bg-chart-5/20",success:"bg-success/10 group-hover:bg-success/20",warning:"bg-warning/10 group-hover:bg-warning/20",destructive:"bg-destructive/10 group-hover:bg-destructive/20"};function fr({title:s,value:t,subtitle:a,icon:n,accentColor:i="primary",isLoading:l,delay:c=0,dataStat:h}){return e.jsx(Y,{className:"stat-card group overflow-hidden animate-fade-up",style:{animationDelay:`${c}ms`},"data-stat":h,children:e.jsx(ee,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s}),l?e.jsx("div",{className:"h-8 w-24 shimmer rounded"}):e.jsx("p",{className:"text-3xl font-bold tracking-tight",children:t}),a&&!l&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a})]}),e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-lg transition-colors ${Ls[i]||Ls.primary}`,children:n})]})})})}function vr({stats:s,isLoading:t}){const a=[{title:"Total Nodes",value:s?K(s.total_nodes):"—",subtitle:s?`${s.online_nodes} online, ${s.pending_nodes} pending, ${s.registering_nodes} registering, ${s.offline_nodes} offline`:void 0,icon:e.jsx(He,{className:"h-5 w-5 text-primary"}),accentColor:"primary",dataStat:"total-nodes"},{title:"Total Requests",value:s?K(s.total_requests):"—",subtitle:s?`${K(s.successful_requests)} successful`:void 0,icon:e.jsx(Ra,{className:"h-5 w-5 text-chart-2"}),accentColor:"chart-2",dataStat:"total-requests"},{title:"Total Tokens",value:s?K(s.total_tokens):"—",subtitle:s?`In: ${K(s.total_input_tokens)} / Out: ${K(s.total_output_tokens)}`:void 0,icon:e.jsx(rs,{className:"h-5 w-5 text-chart-5"}),accentColor:"chart-5",dataStat:"total-tokens"},{title:"Active Requests",value:s?K(s.total_active_requests):"—",icon:e.jsx(As,{className:"h-5 w-5 text-chart-1"}),accentColor:"chart-1",dataStat:"active-requests"},{title:"Queued Requests",value:s?K(s.queued_requests):"—",icon:e.jsx(Fa,{className:"h-5 w-5 text-chart-5"}),accentColor:"chart-5",dataStat:"queued-requests"},{title:"Success Rate",value:s&&s.total_requests>0?vs(s.successful_requests/s.total_requests*100):"—",subtitle:s?`${K(s.failed_requests)} failed`:void 0,icon:s&&s.failed_requests>0?e.jsx(is,{className:"h-5 w-5 text-destructive"}):e.jsx(ns,{className:"h-5 w-5 text-success"}),accentColor:s&&s.failed_requests>0?"destructive":"success",dataStat:"success-rate"},{title:"Avg Response Time",value:s?ws(s.average_response_time_ms):"—",icon:e.jsx(Ue,{className:"h-5 w-5 text-warning"}),accentColor:"warning",dataStat:"average-response-time-ms"},{title:"Avg GPU Usage",value:s?vs(s.average_gpu_usage):"—",icon:e.jsx(Ba,{className:"h-5 w-5 text-chart-3"}),accentColor:"chart-3",dataStat:"average-gpu-usage"},{title:"Avg GPU Memory",value:s?vs(s.average_gpu_memory_usage):"—",icon:e.jsx(tt,{className:"h-5 w-5 text-chart-4"}),accentColor:"chart-4",dataStat:"average-gpu-memory-usage"}];return e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:a.map((n,i)=>e.jsx(fr,{...n,isLoading:t,delay:i*50},n.title))})}function yr(s){switch(s){case"online":return"default";case"pending":return"secondary";case"offline":return"outline";case"error":return"destructive";default:return"outline"}}function Nr(s){switch(s){case"online":return"オンライン";case"pending":return"確認中";case"offline":return"オフライン";case"error":return"エラー";default:return s}}function br({endpoint:s,open:t,onOpenChange:a}){var S,k;const n=me(),[i,l]=r.useState((s==null?void 0:s.name)||""),[c,h]=r.useState((s==null?void 0:s.notes)||""),[j,o]=r.useState(((S=s==null?void 0:s.health_check_interval_secs)==null?void 0:S.toString())||"30"),[d,p]=r.useState(((k=s==null?void 0:s.inference_timeout_secs)==null?void 0:k.toString())||"120"),g=G({mutationFn:x=>Ae.update(s.id,x),onSuccess:()=>{n.invalidateQueries({queryKey:["dashboard-endpoints"]}),A({title:"更新完了",description:"エンドポイント設定を更新しました"})},onError:x=>{A({title:"更新失敗",description:String(x),variant:"destructive"})}}),C=G({mutationFn:()=>Ae.test(s.id),onSuccess:x=>{n.invalidateQueries({queryKey:["dashboard-endpoints"]}),A({title:x.success?"接続成功":"接続失敗",description:x.message||(x.latency_ms?`レイテンシ: ${x.latency_ms}ms`:""),variant:x.success?"default":"destructive"})},onError:x=>{A({title:"接続テスト失敗",description:String(x),variant:"destructive"})}}),f=G({mutationFn:()=>Ae.sync(s.id),onSuccess:x=>{n.invalidateQueries({queryKey:["dashboard-endpoints"]}),A({title:"同期完了",description:`${x.synced_models}件のモデルを同期しました`})},onError:x=>{A({title:"同期失敗",description:String(x),variant:"destructive"})}}),v=()=>{g.mutate({name:i!==(s==null?void 0:s.name)?i:void 0,notes:c!==(s==null?void 0:s.notes)?c:void 0,health_check_interval_secs:parseInt(j)!==(s==null?void 0:s.health_check_interval_secs)?parseInt(j):void 0,inference_timeout_secs:parseInt(d)!==(s==null?void 0:s.inference_timeout_secs)?parseInt(d):void 0})};return s?e.jsx(se,{open:t,onOpenChange:a,children:e.jsxs(te,{className:"max-w-2xl",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5"}),s.name]}),e.jsx(ne,{children:s.base_url})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{variant:yr(s.status),children:Nr(s.status)}),s.supports_responses_api&&e.jsx(_,{variant:"outline",children:"Responses API対応"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["モデル数: ",s.model_count]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>C.mutate(),disabled:C.isPending,children:[e.jsx(at,{className:"h-4 w-4 mr-1"}),"接続テスト"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>f.mutate(),disabled:f.isPending||s.status!=="online",children:[e.jsx(be,{className:`h-4 w-4 mr-1 ${f.isPending?"animate-spin":""}`}),"モデル同期"]})]})]}),e.jsx(Ps,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"レイテンシ:"}),e.jsx("span",{className:"ml-2",children:s.latency_ms!=null?`${s.latency_ms}ms`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"登録日時:"}),e.jsx("span",{className:"ml-2",children:ue(s.registered_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"最終確認:"}),e.jsx("span",{className:"ml-2",children:s.last_seen?ue(s.last_seen):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"エラー回数:"}),e.jsx("span",{className:"ml-2",children:s.error_count})]})]}),s.last_error&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"最後のエラー"})]}),e.jsx("p",{className:"text-sm text-destructive/80 mt-1",children:s.last_error})]}),e.jsx(Ps,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"表示名"}),e.jsx(H,{id:"name",value:i,onChange:x=>l(x.target.value),placeholder:"エンドポイント名"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"healthCheckInterval",children:[e.jsx(Ue,{className:"h-4 w-4 inline mr-1"}),"ヘルスチェック間隔（秒）"]}),e.jsx(H,{id:"healthCheckInterval",type:"number",min:"5",max:"3600",value:j,onChange:x=>o(x.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"inferenceTimeout",children:[e.jsx(Ue,{className:"h-4 w-4 inline mr-1"}),"推論タイムアウト（秒）"]}),e.jsx(H,{id:"inferenceTimeout",type:"number",min:"10",max:"600",value:d,onChange:x=>p(x.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"notes",children:"メモ"}),e.jsx(ga,{id:"notes",value:c,onChange:x=>h(x.target.value),placeholder:"このエンドポイントに関するメモ...",rows:3})]})]})]}),e.jsxs(fe,{children:[e.jsx(b,{variant:"outline",onClick:()=>a(!1),children:"閉じる"}),e.jsxs(b,{onClick:v,disabled:g.isPending,children:[e.jsx(Oa,{className:"h-4 w-4 mr-1"}),g.isPending?"保存中...":"保存"]})]})]})}):null}const Ke=10;function wr(s){switch(s){case"online":return"default";case"pending":return"secondary";case"offline":return"outline";case"error":return"destructive";default:return"outline"}}function Cr(s){switch(s){case"online":return"オンライン";case"pending":return"確認中";case"offline":return"オフライン";case"error":return"エラー";default:return s}}function kr({endpoints:s,isLoading:t}){const a=me(),[n,i]=r.useState(""),[l,c]=r.useState("all"),[h,j]=r.useState("status"),[o,d]=r.useState("desc"),[p,g]=r.useState(1),[C,f]=r.useState(null),[v,S]=r.useState(null),[k,x]=r.useState(!1),[R,P]=r.useState(null),[O,z]=r.useState(null),y=async()=>{if(v){x(!0);try{await Ae.delete(v.id),await a.invalidateQueries({queryKey:["dashboard-endpoints"]})}catch(m){console.error("Failed to delete endpoint:",m)}finally{x(!1),S(null)}}},Z=async m=>{P(m.id);try{await Ae.test(m.id),await a.invalidateQueries({queryKey:["dashboard-endpoints"]})}catch(X){console.error("Failed to test endpoint:",X)}finally{P(null)}},w=async m=>{z(m.id);try{await Ae.sync(m.id),await a.invalidateQueries({queryKey:["dashboard-endpoints"]})}catch(X){console.error("Failed to sync endpoint:",X)}finally{z(null)}},V=r.useMemo(()=>s.filter(m=>{const X=m.name.toLowerCase().includes(n.toLowerCase())||m.base_url.toLowerCase().includes(n.toLowerCase()),ie=l==="all"||m.status===l;return X&&ie}),[s,n,l]),J=r.useMemo(()=>[...V].sort((m,X)=>{let ie=0;switch(h){case"name":ie=m.name.localeCompare(X.name);break;case"status":{const Is={online:0,pending:1,offline:2,error:3};ie=Is[m.status]-Is[X.status];break}case"latency_ms":ie=(m.latency_ms??1/0)-(X.latency_ms??1/0);break;case"model_count":ie=m.model_count-X.model_count;break;case"registered_at":ie=new Date(m.registered_at).getTime()-new Date(X.registered_at).getTime();break}return o==="asc"?ie:-ie}),[V,h,o]),pe=r.useMemo(()=>{const m=(p-1)*Ke;return J.slice(m,m+Ke)},[J,p]),N=Math.ceil(J.length/Ke),L=m=>{h===m?d(o==="asc"?"desc":"asc"):(j(m),d("desc"))},u=({field:m})=>h!==m?null:o==="asc"?e.jsx(fa,{className:"ml-1 h-4 w-4 inline"}):e.jsx(va,{className:"ml-1 h-4 w-4 inline"});return t&&s.length===0?e.jsxs(Y,{children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5"}),"エンドポイント一覧"]})}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(ve,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5"}),"エンドポイント一覧",e.jsx(_,{variant:"secondary",className:"ml-2",children:V.length})]})})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(H,{placeholder:"名前またはURLで検索...",value:n,onChange:m=>{i(m.target.value),g(1)},className:"pl-10"})]}),e.jsxs(De,{value:l,onValueChange:m=>{c(m),g(1)},children:[e.jsx(Ee,{className:"w-[180px]",children:e.jsx(Ie,{placeholder:"ステータス"})}),e.jsxs(qe,{children:[e.jsx(q,{value:"all",children:"すべて"}),e.jsx(q,{value:"online",children:"オンライン"}),e.jsx(q,{value:"pending",children:"確認中"}),e.jsx(q,{value:"offline",children:"オフライン"}),e.jsx(q,{value:"error",children:"エラー"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(W,{children:[e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>L("name"),children:["名前",e.jsx(u,{field:"name"})]}),e.jsx(D,{children:"URL"}),e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>L("status"),children:["ステータス",e.jsx(u,{field:"status"})]}),e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50 text-right",onClick:()=>L("latency_ms"),children:["レイテンシ",e.jsx(u,{field:"latency_ms"})]}),e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50 text-right",onClick:()=>L("model_count"),children:["モデル数",e.jsx(u,{field:"model_count"})]}),e.jsx(D,{children:"最終確認"}),e.jsx(D,{className:"text-right",children:"操作"})]})}),e.jsx(Le,{children:pe.length===0?e.jsx(W,{children:e.jsx(T,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:n||l!=="all"?"条件に一致するエンドポイントがありません":"エンドポイントが登録されていません"})}):pe.map(m=>e.jsxs(W,{children:[e.jsx(T,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:m.name}),m.supports_responses_api&&e.jsx(_,{variant:"outline",className:"text-xs",children:"Responses API"})]})}),e.jsx(T,{children:e.jsx("span",{className:"text-muted-foreground font-mono text-sm",children:m.base_url})}),e.jsxs(T,{children:[e.jsx(_,{variant:wr(m.status),children:Cr(m.status)}),m.last_error&&e.jsxs("span",{className:"ml-2 text-xs text-destructive",children:["(",m.error_count,"回)"]})]}),e.jsx(T,{className:"text-right",children:m.latency_ms!=null?`${m.latency_ms}ms`:"-"}),e.jsx(T,{className:"text-right",children:m.model_count}),e.jsx(T,{children:m.last_seen?ue(m.last_seen):"-"}),e.jsx(T,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>f(m),title:"詳細",children:e.jsx(Pa,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>Z(m),disabled:R===m.id,title:"接続テスト",children:e.jsx(at,{className:E("h-4 w-4",R===m.id&&"animate-pulse")})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>w(m),disabled:O===m.id||m.status!=="online",title:"モデル同期",children:e.jsx(be,{className:E("h-4 w-4",O===m.id&&"animate-spin")})}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>S(m),title:"削除",children:e.jsx(Be,{className:"h-4 w-4 text-destructive"})})]})})]},m.id))})]})}),N>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[J.length," 件中 ",(p-1)*Ke+1," -"," ",Math.min(p*Ke,J.length)," 件を表示"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>g(m=>Math.max(1,m-1)),disabled:p===1,children:e.jsx(Ys,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:[p," / ",N]}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>g(m=>Math.min(N,m+1)),disabled:p===N,children:e.jsx(Zs,{className:"h-4 w-4"})})]})]})]})]}),C&&e.jsx(br,{endpoint:C,open:!!C,onOpenChange:m=>!m&&f(null)}),e.jsx(hs,{open:!!v,onOpenChange:m=>!m&&S(null),children:e.jsxs(Ge,{children:[e.jsxs(Ve,{children:[e.jsx(We,{children:"エンドポイントを削除しますか？"}),e.jsxs(Ze,{children:["「",v==null?void 0:v.name,"」を削除します。この操作は取り消せません。 このエンドポイントに関連するモデルも利用できなくなります。"]})]}),e.jsxs(Qe,{children:[e.jsx(Xe,{disabled:k,children:"キャンセル"}),e.jsx(Je,{onClick:y,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:k?"削除中...":"削除"})]})]})})]})}var ms="Tabs",[Sr]=_s(ms,[Js]),Tt=Js(),[_r,Es]=Sr(ms),Dt=r.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,onValueChange:i,defaultValue:l,orientation:c="horizontal",dir:h,activationMode:j="automatic",...o}=s,d=ba(h),[p,g]=Hs({prop:n,onChange:i,defaultProp:l??"",caller:ms});return e.jsx(_r,{scope:a,baseId:wa(),value:p,onValueChange:g,orientation:c,dir:d,activationMode:j,children:e.jsx(Ne.div,{dir:d,"data-orientation":c,...o,ref:t})})});Dt.displayName=ms;var Et="TabsList",It=r.forwardRef((s,t)=>{const{__scopeTabs:a,loop:n=!0,...i}=s,l=Es(Et,a),c=Tt(a);return e.jsx(ya,{asChild:!0,...c,orientation:l.orientation,dir:l.dir,loop:n,children:e.jsx(Ne.div,{role:"tablist","aria-orientation":l.orientation,...i,ref:t})})});It.displayName=Et;var qt="TabsTrigger",Ft=r.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,disabled:i=!1,...l}=s,c=Es(qt,a),h=Tt(a),j=Ot(c.baseId,n),o=Kt(c.baseId,n),d=n===c.value;return e.jsx(Na,{asChild:!0,...h,focusable:!i,active:d,children:e.jsx(Ne.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":o,"data-state":d?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:j,...l,ref:t,onMouseDown:_e(s.onMouseDown,p=>{!i&&p.button===0&&p.ctrlKey===!1?c.onValueChange(n):p.preventDefault()}),onKeyDown:_e(s.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&c.onValueChange(n)}),onFocus:_e(s.onFocus,()=>{const p=c.activationMode!=="manual";!d&&!i&&p&&c.onValueChange(n)})})})});Ft.displayName=qt;var Pt="TabsContent",Lt=r.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,forceMount:i,children:l,...c}=s,h=Es(Pt,a),j=Ot(h.baseId,n),o=Kt(h.baseId,n),d=n===h.value,p=r.useRef(d);return r.useEffect(()=>{const g=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(g)},[]),e.jsx(Us,{present:i||d,children:({present:g})=>e.jsx(Ne.div,{"data-state":d?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":j,hidden:!g,id:o,tabIndex:0,...c,ref:t,style:{...s.style,animationDuration:p.current?"0s":void 0},children:g&&l})})});Lt.displayName=Pt;function Ot(s,t){return`${s}-trigger-${t}`}function Kt(s,t){return`${s}-content-${t}`}var Ar=Dt,zt=It,$t=Ft,Ut=Lt;const xs=Ar,Ye=r.forwardRef(({className:s,...t},a)=>e.jsx(zt,{ref:a,className:E("inline-flex h-10 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...t}));Ye.displayName=zt.displayName;const $=r.forwardRef(({className:s,...t},a)=>e.jsx($t,{ref:a,className:E("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...t}));$.displayName=$t.displayName;const U=r.forwardRef(({className:s,...t},a)=>e.jsx(Ut,{ref:a,className:E("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));U.displayName=Ut.displayName;const Rr=[25,50,100];function Mr({history:s,isLoading:t}){var C;const[a,n]=r.useState(25),[i,l]=r.useState(1),[c,h]=r.useState(null),[j,o]=r.useState(null),d=Math.ceil(s.length/a),p=s.slice((i-1)*a,i*a),g=async(f,v)=>{try{await navigator.clipboard.writeText(f),o(v),setTimeout(()=>o(null),2e3),A({title:"Copied to clipboard"})}catch{A({title:"Failed to copy",variant:"destructive"})}};return t?e.jsxs(Y,{children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5"}),"Request History"]})}),e.jsx(ee,{children:e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((f,v)=>e.jsx("div",{className:"h-12 shimmer rounded"},v))})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(ve,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5"}),"Request History",e.jsx(_,{variant:"secondary",className:"ml-2",children:s.length})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show"}),e.jsxs(De,{value:a.toString(),onValueChange:f=>{n(Number(f)),l(1)},children:[e.jsx(Ee,{id:"history-per-page",className:"w-20",children:e.jsx(Ie,{})}),e.jsx(qe,{children:Rr.map(f=>e.jsx(q,{value:f.toString(),children:f},f))})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"entries"})]})]})}),e.jsxs(ee,{className:"px-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(Pe,{children:e.jsxs(W,{children:[e.jsx(D,{children:"Time"}),e.jsx(D,{children:"Model"}),e.jsx(D,{children:"Node"}),e.jsx(D,{children:"Status"}),e.jsx(D,{children:"Duration"}),e.jsx(D,{children:"Tokens"})]})}),e.jsx(Le,{id:"request-history-tbody",children:p.length===0?e.jsx(W,{children:e.jsx(T,{colSpan:6,className:"h-32 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx(ze,{className:"h-8 w-8"}),e.jsx("p",{children:"No request history"})]})})}):p.map(f=>{var v,S;return e.jsxs(W,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h(f),children:[e.jsx(T,{className:"font-mono text-xs",children:ue(f.timestamp)}),e.jsx(T,{children:e.jsx(_,{variant:"secondary",children:f.model})}),e.jsx(T,{className:"text-sm",children:f.node_name||((v=f.node_id)==null?void 0:v.slice(0,8))||"—"}),e.jsx(T,{children:e.jsxs(_,{variant:f.status==="success"?"online":"destructive",className:"gap-1",children:[f.status==="success"?e.jsx(ns,{className:"h-3 w-3"}):e.jsx(is,{className:"h-3 w-3"}),f.status]})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ue,{className:"h-3 w-3 text-muted-foreground"}),ws(f.duration_ms)]})}),e.jsx(T,{className:"text-sm",children:((S=f.total_tokens)==null?void 0:S.toLocaleString())||"—"})]},f.request_id)})})]})}),d>1&&e.jsxs("div",{className:"flex items-center justify-between border-t px-6 py-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",(i-1)*a+1," to"," ",Math.min(i*a,s.length)," of ",s.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{id:"history-page-prev",variant:"outline",size:"sm",onClick:()=>l(f=>Math.max(1,f-1)),disabled:i===1,children:e.jsx(Ys,{className:"h-4 w-4"})}),e.jsxs("span",{id:"history-page-info",className:"text-sm",children:["Page ",i," of ",d]}),e.jsx(b,{id:"history-page-next",variant:"outline",size:"sm",onClick:()=>l(f=>Math.min(d,f+1)),disabled:i===d,children:e.jsx(Zs,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(se,{open:!!c,onOpenChange:()=>h(null),children:e.jsxs(te,{id:"request-modal",className:"max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5"}),"Request Details"]}),e.jsxs(ne,{children:["Request ID: ",e.jsx("code",{className:"text-xs",children:c==null?void 0:c.request_id})]})]}),c&&e.jsxs(xs,{defaultValue:"overview",className:"mt-4",children:[e.jsxs(Ye,{className:"grid w-full grid-cols-3",children:[e.jsx($,{value:"overview",children:"Overview"}),e.jsx($,{value:"request",children:"Request"}),e.jsx($,{value:"response",children:"Response"})]}),e.jsxs(U,{value:"overview",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Model"}),e.jsx(_,{variant:"secondary",children:c.model})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(_,{variant:c.status==="success"?"online":"destructive",children:c.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Node"}),e.jsx("p",{className:"text-sm",children:c.node_name||c.node_id||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Duration"}),e.jsx("p",{className:"text-sm",children:ws(c.duration_ms)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Timestamp"}),e.jsx("p",{className:"text-sm",children:new Date(c.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Tokens"}),e.jsx("p",{className:"text-sm",children:((C=c.total_tokens)==null?void 0:C.toLocaleString())||"—"})]})]}),c.error&&e.jsxs("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:"Error"}),e.jsx("p",{className:"mt-1 text-sm",children:c.error})]})]}),e.jsx(U,{value:"request",className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{variant:"ghost",size:"sm",className:"absolute right-2 top-2",onClick:()=>g(JSON.stringify(c.request_body,null,2),"request"),children:j==="request"?e.jsx(he,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})}),e.jsx(Te,{className:"h-64 rounded-md border",children:e.jsx("pre",{className:"p-4 text-xs",children:JSON.stringify(c.request_body,null,2)||"No request body"})})]})}),e.jsx(U,{value:"response",className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{variant:"ghost",size:"sm",className:"absolute right-2 top-2",onClick:()=>g(JSON.stringify(c.response_body,null,2),"response"),children:j==="response"?e.jsx(he,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})}),e.jsx(Te,{className:"h-64 rounded-md border",children:e.jsx("pre",{className:"p-4 text-xs",children:JSON.stringify(c.response_body,null,2)||"No response body"})})]})})]})]})})]})}function Tr({nodes:s}){const[t,a]=r.useState("all"),[n,i]=r.useState(!0),l=r.useRef(null),{data:c,refetch:h,isRefetching:j}=le({queryKey:["router-logs"],queryFn:()=>Re.getRouterLogs({limit:200}),refetchInterval:5e3}),o=c==null?void 0:c.entries,d=o==null?void 0:o.filter(v=>t==="all"?!0:v.level.toLowerCase()===t);r.useEffect(()=>{if(n&&l.current){const v=l.current.querySelector("[data-radix-scroll-area-viewport]");v&&(v.scrollTop=v.scrollHeight)}},[d,n]);const p=()=>{h()},g=()=>{A({title:"Log clearing is handled on the server side"})},C=()=>{if(!d||d.length===0){A({title:"No logs to download",variant:"destructive"});return}const v=d.map(R=>`[${R.timestamp}] [${R.level}] ${R.target?`[${R.target}] `:""}${R.message||""}`).join(`
`),S=new Blob([v],{type:"text/plain"}),k=URL.createObjectURL(S),x=document.createElement("a");x.href=k,x.download=`logs-router-${new Date().toISOString().slice(0,10)}.txt`,x.click(),URL.revokeObjectURL(k),A({title:"Logs downloaded"})},f=v=>{const S=v.toLowerCase();return S==="error"?"text-destructive":S==="warn"||S==="warning"?"text-warning":S==="info"?"text-primary":S==="debug"?"text-muted-foreground":"text-foreground"};return e.jsxs(Y,{children:[e.jsx(ve,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-5 w-5"}),"Log Viewer",d&&e.jsx(_,{variant:"secondary",className:"ml-2",children:d.length})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border rounded-md bg-muted/30",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Router"})]}),e.jsxs(De,{value:t,onValueChange:v=>a(v),children:[e.jsx(Ee,{className:"w-28",children:e.jsx(Ie,{})}),e.jsxs(qe,{children:[e.jsx(q,{value:"all",children:"All"}),e.jsx(q,{value:"error",children:"Error"}),e.jsx(q,{value:"warn",children:"Warn"}),e.jsx(q,{value:"info",children:"Info"}),e.jsx(q,{value:"debug",children:"Debug"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ca,{id:"auto-scroll",checked:n,onCheckedChange:i}),e.jsx(F,{htmlFor:"auto-scroll",className:"text-sm",children:"Auto-scroll"})]})]})]})}),e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsxs(b,{id:"logs-router-refresh",variant:"outline",size:"sm",onClick:p,disabled:j,children:[e.jsx(be,{className:E("mr-2 h-4 w-4",j&&"animate-spin")}),"Refresh"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:C,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Download"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Clear"]})]}),e.jsx(Te,{className:"h-96 rounded-md border bg-muted/30",ref:l,children:e.jsx("div",{id:"logs-router-list",className:"p-4 font-mono text-xs space-y-0.5",children:!d||d.length===0?e.jsx("div",{className:"flex h-32 items-center justify-center text-muted-foreground",children:"No logs available"}):d.map((v,S)=>e.jsxs("div",{className:"flex gap-2 py-0.5 hover:bg-muted/50 rounded px-1 -mx-1",children:[e.jsx("span",{className:"text-muted-foreground shrink-0",children:new Date(v.timestamp).toLocaleTimeString()}),e.jsx("span",{className:E("uppercase w-12 shrink-0 font-semibold",f(v.level)),children:v.level}),v.target&&e.jsxs("span",{className:"text-muted-foreground shrink-0",children:["[",v.target,"]"]}),e.jsx("span",{className:"break-all",children:v.message||""})]},S))})})]})]})}function Dr(){const{data:s,isLoading:t}=le({queryKey:["token-stats-daily"],queryFn:()=>Re.getDailyTokenStats(7)}),{data:a,isLoading:n}=le({queryKey:["token-stats-monthly"],queryFn:()=>Re.getMonthlyTokenStats(6)});return e.jsxs(Y,{children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5"}),"Token Statistics"]})}),e.jsx(ee,{children:e.jsxs(xs,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(Ye,{children:[e.jsxs($,{value:"daily",className:"gap-2",children:[e.jsx(Ha,{className:"h-4 w-4"}),"Daily"]}),e.jsxs($,{value:"monthly",className:"gap-2",children:[e.jsx(Ta,{className:"h-4 w-4"}),"Monthly"]})]}),e.jsx(U,{value:"daily",children:t?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((i,l)=>e.jsx("div",{className:"h-10 shimmer rounded"},l))}):s&&s.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-2 text-sm font-medium text-muted-foreground border-b pb-2",children:[e.jsx("div",{children:"Date"}),e.jsx("div",{className:"text-right",children:"Requests"}),e.jsx("div",{className:"text-right",children:"Input"}),e.jsx("div",{className:"text-right",children:"Output"}),e.jsx("div",{className:"text-right",children:"Total"})]}),s.map(i=>e.jsxs("div",{className:"grid grid-cols-5 gap-2 text-sm py-2 border-b border-border/50",children:[e.jsx("div",{className:"font-medium",children:i.date}),e.jsx("div",{className:"text-right",children:K(i.request_count)}),e.jsx("div",{className:"text-right text-muted-foreground",children:K(i.total_input_tokens)}),e.jsx("div",{className:"text-right text-muted-foreground",children:K(i.total_output_tokens)}),e.jsx("div",{className:"text-right font-medium",children:K(i.total_tokens)})]},i.date))]}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No daily statistics available"})}),e.jsx(U,{value:"monthly",children:n?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((i,l)=>e.jsx("div",{className:"h-10 shimmer rounded"},l))}):a&&a.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-2 text-sm font-medium text-muted-foreground border-b pb-2",children:[e.jsx("div",{children:"Month"}),e.jsx("div",{className:"text-right",children:"Requests"}),e.jsx("div",{className:"text-right",children:"Input"}),e.jsx("div",{className:"text-right",children:"Output"}),e.jsx("div",{className:"text-right",children:"Total"})]}),a.map(i=>e.jsxs("div",{className:"grid grid-cols-5 gap-2 text-sm py-2 border-b border-border/50",children:[e.jsx("div",{className:"font-medium",children:i.month}),e.jsx("div",{className:"text-right",children:K(i.request_count)}),e.jsx("div",{className:"text-right text-muted-foreground",children:K(i.total_input_tokens)}),e.jsx("div",{className:"text-right text-muted-foreground",children:K(i.total_output_tokens)}),e.jsx("div",{className:"text-right font-medium",children:K(i.total_tokens)})]},i.month))]}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No monthly statistics available"})})]})})]})}function bs(s){return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:s<1024*1024*1024?`${(s/(1024*1024)).toFixed(1)} MB`:`${(s/(1024*1024*1024)).toFixed(1)} GB`}function Er(s){return s?s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:String(s):"—"}function Ir(s,t){switch(s){case"downloading":return e.jsx(_,{variant:"secondary","data-model-status":"downloading",children:"Preparing"});case"downloaded":return e.jsxs(_,{variant:"online",className:"gap-1","data-model-status":"ready",children:[e.jsx(he,{className:"h-3 w-3"}),"Ready"]});default:return t==="registered"?e.jsx(_,{variant:"secondary","data-model-status":"registered",children:"Registered"}):e.jsx(_,{variant:"outline","data-model-status":"available",children:"Available"})}}function qr({model:s,onRegister:t,isRegistering:a}){var l,c;const n=s.lifecycle_status==="registered",i=s.status==="available"&&!n;return e.jsx(Y,{className:"model-card overflow-hidden transition-shadow hover:shadow-md","data-model-card":"true","data-model-id":s.id,"data-testid":"model-card",children:e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h4",{className:"truncate font-medium","data-model-name":s.name,children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2","data-model-description":s.description,children:s.description})]}),Ir(s.status,s.lifecycle_status)]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1","data-model-size":bs(s.size_bytes),children:[e.jsx(tt,{className:"h-3 w-3"}),bs(s.size_bytes)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(As,{className:"h-3 w-3"}),bs(s.required_memory_bytes)," VRAM"]}),((l=s.hf_info)==null?void 0:l.downloads)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"h-3 w-3"}),Er(s.hf_info.downloads)]}),((c=s.hf_info)==null?void 0:c.likes)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"h-3 w-3"}),s.hf_info.likes]})]}),s.tags.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:s.tags.map(h=>e.jsx(_,{variant:"outline",className:"text-xs",children:h},h))}),e.jsxs("div",{className:"mt-4",children:[i&&e.jsxs(b,{size:"sm",onClick:()=>t(s),disabled:a,className:"w-full",children:[a?e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Register"]}),s.status==="downloaded"&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(he,{className:"h-4 w-4 text-green-500"}),"Ready to use"]}),n&&s.status!=="downloaded"&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[e.jsx(he,{className:"h-4 w-4 text-green-500"}),"Registered"]})]})]})})}function Fr(){const s=me(),[t,a]=r.useState(""),[n,i]=r.useState(null),{data:l,isLoading:c}=le({queryKey:["models-hub"],queryFn:Se.getHub,refetchInterval:5e3}),h=G({mutationFn:o=>(i(o.id),Se.register({repo:o.repo,filename:o.recommended_filename})),onSuccess:(o,d)=>{s.invalidateQueries({queryKey:["models-hub"]}),s.invalidateQueries({queryKey:["registered-models"]}),A({title:`Model ${d.name} registered`}),i(null)},onError:(o,d)=>{A({title:`Failed to register ${d.name}`,description:o instanceof Error?o.message:"Unknown error",variant:"destructive"}),i(null)}}),j=l==null?void 0:l.filter(o=>o.name.toLowerCase().includes(t.toLowerCase())||o.description.toLowerCase().includes(t.toLowerCase())||o.tags.some(d=>d.toLowerCase().includes(t.toLowerCase())));return c?e.jsx("div",{className:"space-y-4",children:[...Array(6)].map((o,d)=>e.jsx("div",{className:"h-40 shimmer rounded"},d))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(H,{id:"hub-search",placeholder:"Search models...",value:t,onChange:o=>a(o.target.value),className:"pl-9"})]}),e.jsx("div",{id:"hub-models-list",children:!j||j.length===0?e.jsxs("div",{className:"flex h-32 flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(ls,{className:"h-8 w-8"}),e.jsx("p",{children:"No models found"})]}):e.jsx("div",{className:E("grid gap-4 sm:grid-cols-2 lg:grid-cols-3"),children:j.map(o=>e.jsx(qr,{model:o,onRegister:d=>h.mutate(d),isRegistering:n===o.id},o.id))})})]})}function Os(s){return s==null||Number.isNaN(s)?"—":`${s.toFixed(1)} GB`}function Pr(s){return s==null||Number.isNaN(s)?"—":`${(s/(1024*1024*1024)).toFixed(1)} GB`}function Lr(s,t){if(t)return e.jsx(_,{variant:"online",children:"Ready"});switch(s){case"registered":return e.jsx(_,{variant:"online",children:"Registered"});case"pending":return e.jsx(_,{variant:"outline",children:"Pending"});case"error":return e.jsx(_,{variant:"destructive",children:"Error"});default:return e.jsx(_,{variant:"outline",children:s})}}const Ks={openai:{name:"OpenAI",color:"text-green-600"},anthropic:{name:"Anthropic",color:"text-orange-600"},google:{name:"Google",color:"text-blue-600"}};function Or(){const s=me(),[t,a]=r.useState(""),[n,i]=r.useState(!1),[l,c]=r.useState(""),[h,j]=r.useState(""),[o,d]=r.useState(""),[p,g]=r.useState(!1),[C,f]=r.useState(""),[v,S]=r.useState([]);function k(){c(""),j(""),d(""),g(!1),f(""),S([])}const{data:x,isLoading:R}=le({queryKey:["registered-models"],queryFn:Se.getRegistered,refetchInterval:1e4}),P=G({mutationFn:u=>Se.register(u),onSuccess:()=>{s.invalidateQueries({queryKey:["registered-models"]}),A({title:"Model registered"}),i(!1),k()},onError:u=>{A({title:"Failed to register model",description:u instanceof Error?u.message:"Unknown error",variant:"destructive"})}}),O=G({mutationFn:u=>Se.discoverGguf(u),onSuccess:u=>{f(u.base_model),S(u.gguf_alternatives),g(!0)},onError:u=>{A({title:"Failed to discover GGUF alternatives",description:u instanceof Error?u.message:"Unknown error",variant:"destructive"})}}),z=G({mutationFn:u=>Se.delete(u),onSuccess:()=>{s.invalidateQueries({queryKey:["registered-models"]}),s.invalidateQueries({queryKey:["models-hub"]}),A({title:"Model deleted"})},onError:u=>{A({title:"Failed to delete model",description:u instanceof Error?u.message:"Unknown error",variant:"destructive"})}}),y=x,Z=y==null?void 0:y.filter(u=>u.owned_by==="router"||!u.owned_by),w=y==null?void 0:y.filter(u=>u.owned_by==="openai"),V=y==null?void 0:y.filter(u=>u.owned_by==="anthropic"),J=y==null?void 0:y.filter(u=>u.owned_by==="google"),pe=Z==null?void 0:Z.filter(u=>u.name.toLowerCase().includes(t.toLowerCase())),N=u=>e.jsx(Y,{className:"overflow-hidden",children:e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h4",{className:"truncate font-medium",children:u.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u.owned_by||"cloud"})]}),e.jsx(_,{variant:"online",children:"Ready"})]}),u.description&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:u.description})]})},u.name),L=(u,m)=>R?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((X,ie)=>e.jsx("div",{className:"h-24 shimmer rounded"},ie))}):!u||u.length===0?e.jsxs("div",{className:"flex h-32 flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(ss,{className:"h-8 w-8"}),e.jsxs("p",{children:["No ",Ks[m].name," models available"]}),e.jsxs("p",{className:"text-sm",children:["Configure ",Ks[m].name," API key to access models"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(N)});return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5"}),"Models"]})}),e.jsx(ee,{children:e.jsxs(xs,{defaultValue:"local",className:"space-y-4",children:[e.jsxs(Ye,{className:"flex-wrap",children:[e.jsxs($,{value:"local",className:"gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Local",Z&&e.jsx(_,{variant:"secondary",className:"ml-1",children:Z.length})]}),e.jsxs($,{value:"hub",className:"gap-2",children:[e.jsx($a,{className:"h-4 w-4"}),"Model Hub"]}),w&&w.length>0&&e.jsxs($,{value:"openai",className:"gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-green-600"}),"OpenAI",e.jsx(_,{variant:"secondary",className:"ml-1",children:w.length})]}),V&&V.length>0&&e.jsxs($,{value:"anthropic",className:"gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-orange-600"}),"Anthropic",e.jsx(_,{variant:"secondary",className:"ml-1",children:V.length})]}),J&&J.length>0&&e.jsxs($,{value:"google",className:"gap-2",children:[e.jsx(ss,{className:"h-4 w-4 text-blue-600"}),"Google",e.jsx(_,{variant:"secondary",className:"ml-1",children:J.length})]})]}),e.jsxs(U,{value:"local",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(H,{placeholder:"Search local models...",value:t,onChange:u=>a(u.target.value),className:"pl-9"})]}),e.jsxs(b,{id:"register-model",variant:"outline",onClick:()=>i(!0),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Register"]})]}),R?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((u,m)=>e.jsx("div",{className:"h-24 shimmer rounded"},m))}):!pe||pe.length===0?e.jsxs("div",{className:"flex h-32 flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(as,{className:"h-8 w-8"}),e.jsx("p",{children:"No local models"}),e.jsx("p",{className:"text-sm",children:"Register from the Model Hub or add a Hugging Face repo"})]}):e.jsx("div",{id:"local-models-list",className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:pe.map(u=>e.jsx(Y,{className:"overflow-hidden",children:e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h4",{className:"truncate font-medium",children:u.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.source||"local",u.repo?` • ${u.repo}`:""]})]}),Lr(u.lifecycle_status,u.ready)]}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Size: ",Os(u.size_gb)]}),e.jsxs("p",{className:"text-muted-foreground",children:["Required VRAM: ",Os(u.required_memory_gb)]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>z.mutate(u.name),disabled:z.isPending,children:e.jsx(Be,{className:"h-4 w-4 text-destructive"})})})]})},u.name))})]}),e.jsx(U,{value:"hub",children:e.jsx(Fr,{})}),e.jsx(U,{value:"openai",className:"space-y-4",children:L(w,"openai")}),e.jsx(U,{value:"anthropic",className:"space-y-4",children:L(V,"anthropic")}),e.jsx(U,{value:"google",className:"space-y-4",children:L(J,"google")})]})})]}),e.jsx(se,{open:n,onOpenChange:u=>{i(u),u||k()},children:e.jsxs(te,{id:"register-modal",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Register Model"}),e.jsxs(ne,{children:["Register a model from Hugging Face. If a repository contains multiple artifacts, specify the exact filename to use. Nodes download artifacts directly. Browse models at"," ",e.jsx("a",{href:"https://huggingface.co/models",target:"_blank",rel:"noopener noreferrer",className:"text-primary underline",children:"huggingface.co"})]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"register-repo",children:"Repo"}),e.jsx(H,{id:"register-repo",placeholder:"nvidia/NVIDIA-Nemotron-3-Nano-30B-A3B-BF16",value:l,onChange:u=>c(u.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-md border bg-muted/30 px-3 py-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"If the repo you entered is a base model repo (safetensors), you can discover GGUF alternatives."}),e.jsxs(b,{id:"discover-gguf",variant:"outline",size:"sm",disabled:!l.trim()||O.isPending,onClick:()=>O.mutate(l.trim()),children:[O.isPending?e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Discover"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"register-filename",children:"Filename (optional)"}),e.jsx(H,{id:"register-filename",placeholder:"model.safetensors or model.Q4_K_M.gguf",value:h,onChange:u=>j(u.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If the repo has multiple artifacts, specify the exact filename you want the node to download."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"register-display-name",children:"Display name (optional)"}),e.jsx(H,{id:"register-display-name",placeholder:"Optional display name",value:o,onChange:u=>d(u.target.value)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The router stores metadata only. Nodes download model artifacts directly from Hugging Face."})]}),e.jsxs(fe,{children:[e.jsx(b,{id:"register-modal-close",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(b,{id:"register-submit",onClick:()=>P.mutate({repo:l.trim(),filename:h.trim()?h.trim():void 0,display_name:o.trim()?o.trim():void 0}),disabled:!l.trim()||P.isPending,children:[P.isPending?e.jsx(Q,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Register"]})]})]})}),e.jsx(se,{open:p,onOpenChange:g,children:e.jsxs(te,{id:"discover-gguf-modal",className:"max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"GGUF alternatives"}),e.jsxs(ne,{children:["Discover GGUF repos for ",e.jsx("code",{children:C||l||"model"})," and pick an exact file."]})]}),e.jsx("div",{className:"max-h-[60vh] space-y-3 overflow-y-auto pr-1",children:v.length===0?e.jsx("div",{className:"rounded-md border bg-muted/30 p-4 text-sm text-muted-foreground",children:"No GGUF alternatives found. Try a different search term or check Hugging Face manually."}):v.map(u=>e.jsxs(Y,{className:"border-border/50",children:[e.jsxs(ve,{className:"pb-3",children:[e.jsxs(ye,{className:"text-base",children:[u.repo," ",u.trusted?e.jsx(_,{variant:"secondary",className:"ml-2",children:"trusted"}):null]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Provider: ",u.provider]})]}),e.jsx(ee,{className:"space-y-2",children:u.files.map(m=>e.jsxs("div",{className:"flex flex-col gap-2 rounded-md border bg-background px-3 py-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:m.filename}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[m.quantization?e.jsxs("span",{children:[m.quantization," - "]}):null,Pr(m.size_bytes)]})]}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>{c(u.repo),j(m.filename),g(!1),A({title:"Selected GGUF file",description:`${u.repo} - ${m.filename}`})},children:"Use"})]},`${u.repo}/${m.filename}`))})]},u.repo))}),e.jsx(fe,{children:e.jsx(b,{variant:"outline",onClick:()=>g(!1),children:"Close"})})]})})]})}function Kr(){const{user:s}=Rs(),{isConnected:t}=Va(),[a,n]=r.useState(null),[i,l]=r.useState(null),c=r.useRef(null),h=t?1e4:5e3,j=r.useCallback(async()=>{c.current=performance.now();const x=await Re.getOverview(),R=performance.now();return l(Math.round(R-(c.current||R))),n(new Date),x},[]),{data:o,isLoading:d,error:p,refetch:g}=le({queryKey:["dashboard-overview"],queryFn:j,refetchInterval:h}),{data:C,isLoading:f}=le({queryKey:["request-responses"],queryFn:()=>Re.getRequestResponses({limit:100}),refetchInterval:h}),{data:v,isLoading:S}=le({queryKey:["dashboard-endpoints"],queryFn:()=>Re.getEndpoints(),refetchInterval:h}),k=r.useMemo(()=>C!=null&&C.records?C.records.map(x=>({request_id:x.id,timestamp:x.timestamp,model:x.model,node_id:x.node_id,node_name:x.node_machine_name,status:x.status.type,duration_ms:x.duration_ms,error:x.status.type==="error"?x.status.message:void 0,request_body:x.request_body,response_body:x.response_body})):[],[C]);return p?e.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-destructive/10",children:e.jsx(et,{className:"h-8 w-8 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Failed to load dashboard"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:p instanceof Error?p.message:"An error occurred"})]}),e.jsx("button",{onClick:()=>g(),className:"text-sm text-primary hover:underline",children:"Try again"})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"fixed inset-0 bg-grid opacity-20 pointer-events-none"}),e.jsx(gr,{user:s,isConnected:!p,lastRefreshed:a,fetchTimeMs:i}),e.jsxs("main",{className:"relative mx-auto max-w-[1600px] px-4 py-6 sm:px-6 lg:px-8",children:[e.jsx("section",{className:"mb-8",children:e.jsx(vr,{stats:o==null?void 0:o.stats,isLoading:d})}),e.jsxs(xs,{defaultValue:"endpoints",className:"space-y-6",children:[e.jsxs(Ye,{className:"grid w-full grid-cols-5 lg:w-auto lg:inline-grid",children:[e.jsxs($,{value:"endpoints",className:"gap-2",children:[e.jsx(qa,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Endpoints"})]}),e.jsxs($,{value:"models",className:"gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Models"})]}),e.jsxs($,{value:"statistics",className:"gap-2",children:[e.jsx(Da,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Statistics"})]}),e.jsxs($,{value:"history",className:"gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"History"})]}),e.jsxs($,{value:"logs",className:"gap-2",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Logs"})]})]}),e.jsx(U,{value:"endpoints",className:"animate-fade-in",children:e.jsx(kr,{endpoints:v||[],isLoading:S})}),e.jsx(U,{value:"models",className:"animate-fade-in",children:e.jsx(Or,{})}),e.jsx(U,{value:"statistics",className:"animate-fade-in",children:e.jsx(Dr,{})}),e.jsx(U,{value:"history",className:"animate-fade-in",children:e.jsx(Mr,{history:k,isLoading:f})}),e.jsx(U,{value:"logs",className:"animate-fade-in",children:e.jsx(Tr,{})})]})]})]})}function zr(){const{isLoading:s}=Rs();return r.useEffect(()=>{!s&&!$s()&&(window.location.href="/dashboard/login.html")},[s]),s?e.jsx("div",{className:"flex h-screen w-full items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-12 w-12 rounded-full border-4 border-primary/20"}),e.jsx("div",{className:"absolute inset-0 h-12 w-12 animate-spin rounded-full border-4 border-transparent border-t-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]})}):e.jsx(Kr,{})}const $r=new ka({defaultOptions:{queries:{staleTime:5e3,refetchInterval:5e3,retry:1}}});Qt.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(Sa,{client:$r,children:e.jsx(Aa,{children:e.jsxs(Wt,{children:[e.jsx(zr,{}),e.jsx(Zt,{})]})})})}));
