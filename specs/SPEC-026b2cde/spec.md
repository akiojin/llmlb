# 機能仕様書: リクエスト履歴一覧のページネーション機能

**機能ID**: `SPEC-026b2cde`
**作成日**: 2025-11-03
**ステータス**: ✅ 実装完了
**依存SPEC**: SPEC-fbc50d97（履歴保存）
**入力**: ユーザー説明: "リクエスト履歴一覧のページネーション機能"

## ユーザーシナリオ＆テスト *(必須)*

### ユーザーストーリー1 - 表示件数の選択 (優先度: P1)

管理者として、リクエスト履歴一覧画面で一度に表示する件数を25件/50件/100件から選択できるようにしたい。大量の履歴がある場合でも、自分の好みに応じて快適に閲覧できるようにするため。

**この優先度の理由**: 大量の履歴（100件以上）がある環境では、全件を一度に表示するとページの読み込みが遅くなり、ユーザー体験が著しく低下する。表示件数の選択機能は、パフォーマンスとユーザビリティの両方を改善する最も重要な機能である。

**独立テスト**: ドロップダウンで表示件数を変更し、テーブルに表示される件数が正しく変更されることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提** リクエスト履歴が150件ある、**実行** 表示件数ドロップダウンで「25件」を選択、**結果** テーブルに25件のみ表示され、ページネーションが「1 / 6」と表示される
2. **前提** 表示件数が25件に設定されている、**実行** 「50件」に変更、**結果** テーブルに50件表示され、ページネーションが「1 / 3」に更新される
3. **前提** リクエスト履歴が30件ある、**実行** 「50件」を選択、**結果** 全30件が1ページに表示され、ページネーションボタンが無効になる

---

### ユーザーストーリー2 - ページ間の移動 (優先度: P1)

管理者として、前のページ・次のページボタンを使って簡単にページ間を移動したい。大量の履歴を効率的に確認するため。

**この優先度の理由**: 表示件数選択と同等に重要。ページネーション機能の中核であり、これがなければ2ページ目以降の履歴にアクセスできない。

**独立テスト**: 「次へ」「前へ」ボタンをクリックして、正しくページが切り替わることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提** 150件の履歴があり1ページ目を表示中、**実行** 「次へ」ボタンをクリック、**結果** 2ページ目が表示され、ページネーションが「2 / 3」に更新される
2. **前提** 2ページ目を表示中、**実行** 「前へ」ボタンをクリック、**結果** 1ページ目に戻り、ページネーションが「1 / 3」に更新される
3. **前提** 最終ページを表示中、**実行** 「次へ」ボタンを確認、**結果** 「次へ」ボタンが無効になっている
4. **前提** 1ページ目を表示中、**実行** 「前へ」ボタンを確認、**結果** 「前へ」ボタンが無効になっている

---

### ユーザーストーリー3 - フィルタとの連携 (優先度: P2)

管理者として、モデル名でフィルタをかけたり表示件数を変更したりした際に、自動的に1ページ目にリセットされるようにしたい。混乱を避け、フィルタ結果の最初から確認するため。

**この優先度の理由**: ユーザビリティの改善。フィルタ変更後に2ページ目以降に留まると、ユーザーが「フィルタが効いていないのでは？」と混乱する可能性がある。

**独立テスト**: フィルタを適用した際、ページ番号が1にリセットされることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提** 3ページ目を表示中、**実行** モデル名フィルタに「gpt」と入力、**結果** フィルタされた結果の1ページ目が表示される
2. **前提** 2ページ目を表示中、**実行** 表示件数を変更、**結果** 1ページ目にリセットされる

---

### ユーザーストーリー4 - 現在位置の把握 (優先度: P2)

管理者として、現在何ページ目にいるのか、全部で何ページあるのかを一目で把握したい。履歴全体の中での現在位置を理解するため。

**この優先度の理由**: ナビゲーションの補助機能。必須ではないが、ユーザーが現在位置を把握するのに役立つ。

**独立テスト**: ページネーション表示が「現在ページ / 総ページ数」形式で正しく表示されることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提** 150件の履歴があり50件/ページ設定、**実行** 画面を表示、**結果** 「1 / 3」と表示される
2. **前提** 2ページ目を表示中、**実行** ページネーション表示を確認、**結果** 「2 / 3」と表示される

---

### エッジケース

- 履歴が0件の場合、ページネーションは「- / -」と表示され、前へ/次へボタンは両方とも無効になる
- 履歴が表示件数以下（例: 30件で50件/ページ設定）の場合、ページネーションは「1 / 1」と表示され、前へ/次へボタンは両方とも無効になる
- フィルタ適用後に結果が0件になった場合、「履歴がありません」メッセージが表示され、ページネーションが正しく更新される
- 最終ページに遷移後、さらに「次へ」をクリックしようとしても何も起こらない（ボタンが無効のため）

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは、1ページに表示するリクエスト履歴件数を25件/50件/100件から選択できるドロップダウンを提供する必要がある
- **FR-002**: システムは、デフォルトで50件/ページを表示する必要がある
- **FR-003**: システムは、「前へ」「次へ」ボタンでページ間を移動できる機能を提供する必要がある
- **FR-004**: システムは、現在のページ番号と総ページ数を「X / Y」形式で表示する必要がある
- **FR-005**: システムは、1ページ目では「前へ」ボタンを無効にする必要がある
- **FR-006**: システムは、最終ページでは「次へ」ボタンを無効にする必要がある
- **FR-007**: システムは、モデル名フィルタが変更された際に1ページ目にリセットする必要がある
- **FR-008**: システムは、表示件数が変更された際に1ページ目にリセットする必要がある
- **FR-009**: システムは、リクエスト履歴を新しい順（降順）で表示する必要がある（既存機能の維持）
- **FR-010**: システムは、履歴が0件の場合「- / -」と表示し、両方のボタンを無効にする必要がある

### 主要エンティティ

- **ページネーション状態**: 現在のページ番号、1ページあたりの表示件数、フィルタ条件を保持する
- **リクエスト履歴**: 既存のリクエスト履歴データ構造（変更なし）

---

## スコープ外 *(オプション)*

以下の機能は本仕様のスコープ外とし、将来のバージョンで対応予定:

- ページ番号の直接入力機能
- 「最初のページへ」「最後のページへ」ボタン
- URLにページ番号を含める（ブックマーク/共有対応）
- サーバーサイドページネーション（現在はクライアントサイド）

---

## 前提条件 *(該当する場合)*

この機能は以下を前提とします:

- リクエスト履歴一覧機能（SPEC-fbc50d97）が既に実装されている
- リクエスト履歴データは既にメモリ上にロード済み（クライアントサイドページング）
- ブラウザはJavaScript（ES6+）をサポートしている

---

## 依存関係 *(該当する場合)*

この機能は以下に依存します:

- リクエスト履歴保存・表示機能（SPEC-fbc50d97）
- 既存のフィルタ機能（モデル名フィルタ）

---

## Clarifications

### Session 2025-12-24

仕様を精査した結果、重大な曖昧さは検出されませんでした。実装も完了しています。

**確認済み事項**:

- 表示件数オプション: 25件/50件/100件（FR-001で明記）
- デフォルト: 50件（FR-002で明記）
- 表示形式: 「X / Y」形式（FR-004で明記）
- リセット条件: フィルタ変更時、件数変更時（FR-007, FR-008で明記）
- 0件時表示: 「- / -」（FR-010で明記）
- パフォーマンス: ページ切替0.1秒以内（成功基準2で明記）

**実装方式**:

- クライアントサイドページネーション（サーバーサイドはスコープ外）

---

## 成功基準 *(必須)*

以下の成功基準を満たす必要があります:

1. ユーザーは3回のクリック以内で任意のページに到達できる（150件の履歴の場合）
2. ページ切り替えは即座に（0.1秒以内に）完了する（クライアントサイドページング）
3. 表示件数変更後、ページレイアウトが崩れずに正しく再描画される
4. 100件以上の履歴がある場合でも、初期ロード時間は2秒以内である
5. フィルタ適用後、1ページ目が自動的に表示される

---

## ⚡ クイックガイドライン

- ✅ ユーザーが「何を」必要とし「なぜ」必要なのかに焦点を当てる
- ❌ 「どのように」実装するかを避ける (技術スタック、API、コード構造なし)
- 👥 ビジネス関係者向けに記述 (開発者向けではない)
