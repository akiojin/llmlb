# SPEC-08d2b908: モデル管理（統合仕様）

**ステータス**: 計画中（統合）

## この仕様の役割（初見向け）
この仕様は**モデル管理の入口ガイド**です。  
「登録/配布/保存/形式選択」の責務境界と禁止事項をまとめ、詳細は下記の個別SPECに委譲します。

## 背景 / 問題
モデル管理に関する要件が複数SPECに分散しており、重複や矛盾が起きやすい。
登録・配布・保存・形式選択の責務を統合的に定義し、実行エンジン領域と明確に分離する必要がある。

## 目的
- モデル管理（登録/配布/保存/形式選択）の責務境界を明確化する
- safetensors/GGUFの扱いと必須メタデータ要件を統一する
- /v1/models の可視性や削除・重複の扱いを一貫させる

## スコープ
- ルーター側の登録フロー（URL入力・重複・削除・一覧）
- 形式選択（safetensors/GGUF）とGGUF量子化ポリシー
- Node側のモデル配置・解決ルール
- 実体（safetensors/GGUF）の有無に基づく ready 判定

## 非ゴール
- 推論エンジンの選択/実装
- 自動変換（非GGUF→GGUF）や量子化生成
- モデル品質評価

## 原則
- 登録時に形式は確定し、実行時に自動判別しない
- `metadata.json` のような独自メタデータには依存しない
- `config.json` と `tokenizer.json` などのHF由来メタデータを正とする

## 決定事項（共有用サマリ）
- **形式選択の必須条件**: safetensors/GGUF が両方存在する場合、`format` は必須。未指定は 400 エラー。
- **形式選択の省略条件**: どちらか一方のみ存在する場合、`format` 省略を許可し、その形式で登録する。
- **GGUF量子化の選択**: `format=gguf` かつ `filename` 未指定の場合に限り、`gguf_policy`（`quality`/`memory`/`speed`）を必須とする。
- **safetensorsの必須メタデータ**: `config.json` と `tokenizer.json` は必須。不足時は登録エラー。
- **シャーディングの扱い**: `.safetensors` が複数存在する場合は `.safetensors.index.json` を必須とし、欠落時は曖昧としてエラー。
- **実行エンジンの責務分離**: 公式最適化アーティファクト等の実行優先度はエンジン領域で扱い、モデル管理は登録時の形式確定のみを担う。

## 詳細仕様（参照）
- **モデルストレージと解決**: `SPEC-dcaeaec4`, `SPEC-48678000`
- **HF URL登録**: `SPEC-11106000`
- **形式選択/量子化ポリシー**: `SPEC-a61b24f2`
- **ready判定/削除整合**: `SPEC-6c2d9f1e`

## 受け入れ条件
1. 形式選択・登録・保存のルールが相互に矛盾しない。
2. /v1/models は実体（safetensors/GGUF）が存在するものだけを返す。
3. 自動変換や暗黙のフォールバックは行わない。

## 依存関係
- `SPEC-dcaeaec4`（モデルストレージ）
- `SPEC-11106000`（登録フロー）
- `SPEC-a61b24f2`（形式選択）
- `SPEC-48678000`（モデル解決）
- `SPEC-6c2d9f1e`（ready/削除の整合）
