# SPEC-3fc2c1e4: 実行エンジン（統合仕様）

**ステータス**: 計画中（統合）

## この仕様の役割（初見向け）
この仕様は**実行エンジン領域の入口ガイド**です。  
エンジン選択/抽象化の原則をまとめ、詳細は下記の個別SPECに委譲します。

## 背景 / 問題
推論エンジンに関する要件が分散し、モデル管理と混在することで責務が曖昧になっている。
実行エンジン領域を統合し、モデル管理とは明確に分離する必要がある。

## 目的
- Node側エンジン抽象化と推論責務を統合的に定義する
- GPU前提（Metal/CUDA）の実行要件を明確化する
- エンジン選択が登録時のアーティファクトに従うことを保証する

## スコープ
- Node側のエンジン抽象化（EngineRegistry/Engineの責務）
- 実行環境の前提（GPU必須）
- 登録時に確定した形式とHFメタデータに基づくエンジン選択

## 非ゴール
- モデル登録・形式選択・保存（モデル管理領域）
- 自動変換/量子化生成
- Nemotron推論エンジンの詳細設計（TBD）

## 原則
- `metadata.json` のような独自メタデータには依存しない
- エンジン選択は「登録時に確定したアーティファクト」を正とする

## 決定事項（共有用サマリ）
- **責務分離**: 形式選択は登録時に確定し、実行時はその結果に従う（実行時の自動判別/フォールバック禁止）。
- **Node前提**: Node は Python 依存を導入しない。
- **GPU前提**: GPU 非搭載ノードは対象外（登録不可）。
- **対応OS/GPU**:
  - macOS: Apple Silicon のみ対象
  - Linux/Windows: CUDA (GeForce系を含む) を対象
  - WSL2: GPUが検出できる場合のみ対象
- **safetensors優先**: 登録時に `format=safetensors` を選ぶ限り、safetensors が正本。
- **最適化アーティファクト**: 公式最適化アーティファクトの利用優先はエンジン領域の実行最適化として扱い、登録時の形式選択を置き換えない。
- **Nemotron**: 新エンジンの仕様/実装は後回し（TBD）。

## 詳細仕様（参照）
- **エンジン抽象化**: `SPEC-d7feaa2c`
- **gpt-oss-20b safetensors 実行**: `SPEC-2c0e5a9b`
- **gptossアーキテクチャエイリアス**: `SPEC-8a2d1d43`
- **Nemotron PoC**: `SPEC-efff1da7`

## 受け入れ条件
1. Nodeのエンジン選択は登録済みアーティファクトとHFメタデータに一致する。
2. GPU非搭載ノードは対象外とする。
3. モデル管理の仕様と矛盾しない。

## 依存関係
- `SPEC-08d2b908`（モデル管理統合）
- `SPEC-5cd7b614`（GPU必須ノード登録要件）
