# データモデル: Playground Chat マルチモーダル対応（SPEC-5fc9fe92）

## 目的

Playground Chat の「メッセージ」と「添付（画像/音声）」を、UI表示とAPI送信の両面で
曖昧さなく扱えるようにデータ構造を整理する。

## UI内の概念モデル

### チャットセッション

- セッションID
- タイトル
- 選択モデル
- メッセージ一覧（※添付データそのものは永続化しない方針）
- 作成/更新日時

### メッセージ

- 送信者（system/user/assistant）
- 表示用テキスト
- 表示用の添付（任意）
  - 添付種別（画像/音声）
  - MIMEタイプ
  - ファイル名（任意）
  - サイズ（バイト）
  - 表示/再生に必要な一時URL（ブラウザ内）
- 回答由来のメディア（任意）
  - アシスタント本文に含まれるURL/データURLから抽出した画像/音声
  - 画像プレビュー、音声プレイヤーとして表示する

### 下書き（送信前）

- 入力テキスト
- 添付（任意、MVPでは画像 or 音声のどちらか1つ）
  - 添付元は「ファイル選択」または「貼り付け（ペースト）」を想定する

## API送信モデル（OpenAI互換の考え方）

### `/v1/chat/completions` の messages

- `role`: system/user/assistant
- `content`: 以下のいずれか
  1. **テキストのみ**: 文字列
  2. **マルチモーダル**: parts配列（テキストパート + 画像 or 音声パート）

※アシスタント応答は通常テキスト（文字列）だが、本文に画像/音声URLやデータURLが含まれる場合は
UI側で抽出して埋め込み表示する。

### parts（MVPで扱う種類）

- textパート（必須）: 送信テキスト
- imageパート（任意）: 画像を表す情報（base64やURL）
- audioパート（任意）: 音声を表す情報（base64や形式）

※具体的なJSONスキーマは `contracts/` に集約する。

## 履歴（監査・デバッグ）での取り扱い

ルーターのリクエスト履歴に保存する際は、添付の生データは保持しない。

- 画像/音声のパートは「要約」に置換（種別、サイズ、ハッシュ等）
- テキストはそのまま保存（既存と同様）
