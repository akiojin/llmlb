# SPEC-6cd7f960: 対応モデルリスト型管理

## ステータス

- **Status**: Draft
- **Priority**: P1
- **Created**: 2025-12-28

## 概要

モデル管理方式を「ユーザーがHuggingFace URLを入力して登録する形式」から
「予め動作確認済みのモデルを一覧表示してPullする形式」に変更する。

## 背景と動機

### 現状の課題

1. ユーザーが任意のHuggingFace URLを入力してモデルを登録できる
2. 対応していないモデルアーキテクチャの場合、正常に動作しない
3. ダウンロード後にエラーが発生し、ユーザー体験を損なう
4. サポート対象外のモデルへの問い合わせが発生する

### 解決策

動作確認済みのモデルのみを「対応モデル」として内部リストに持ち、
ユーザーはそのリストからモデルを選択してPullする形式に変更する。

## ユーザーストーリー

### US-1: モデル一覧の確認

```
ユーザーとして、
対応しているモデルの一覧を確認したい。
なぜなら、どのモデルが利用可能か知りたいから。
```

**受入条件**:

- ダッシュボードの「Model Hub」タブで対応モデル一覧が表示される
- 各モデルに名前、説明、サイズ、必要VRAM、タグが表示される
- HuggingFaceのダウンロード数・スター数が表示される（オプション）
- 検索バーでモデル名による絞り込みができる

### US-2: モデルのPull

```
ユーザーとして、
対応モデルをPullしてローカルにダウンロードしたい。
なぜなら、推論に使用するモデルを準備したいから。
```

**受入条件**:

- 「Pull」ボタンをクリックするとダウンロードが開始される
- ダウンロード進捗がプログレスバーで表示される
- ダウンロード完了後、「Local」タブにモデルが表示される
- ダウンロード中のモデルは「downloading」状態として表示される

### US-3: ダウンロード済みモデルの確認

```
ユーザーとして、
ダウンロード済みのモデルを確認したい。
なぜなら、どのモデルが利用可能か把握したいから。
```

**受入条件**:

- ダッシュボードの「Local」タブでダウンロード済みモデル一覧が表示される
- 各モデルのサイズ、必要VRAM、パスが表示される
- モデルの削除ができる

### US-4: モデルの状態確認

```
ユーザーとして、
各モデルの状態（未ダウンロード/ダウンロード中/ダウンロード済み）を
一目で確認したい。
なぜなら、次に何をすべきか判断したいから。
```

**受入条件**:

- Model Hubタブで各モデルに状態バッジが表示される
  - 「available」: 未ダウンロード（Pullボタン表示）
  - 「downloading」: ダウンロード中（プログレス表示）
  - 「downloaded」: ダウンロード済み（チェックマーク表示）

## 機能要件

### FR-1: 対応モデルリストの管理

- 動作確認済みモデルを内部リストとして管理する
- リストにはモデルID、名前、説明、HFリポジトリ、推奨ファイル名、
  サイズ、必要VRAM、タグ、能力を含む
- 新しいモデルの追加はローカルテスト後にコード更新で行う

### FR-2: モデル一覧API

- `GET /v0/models` で対応モデル一覧と状態を返す
- 各モデルに `status` フィールド（available/downloading/downloaded）を含む
- ダウンロード中のモデルには `download_progress` を含む
- HuggingFaceの動的情報（ダウンロード数、スター数）を含む（キャッシュ付き）

### FR-3: モデルPull API

- `POST /v0/models/pull` で対応モデルのダウンロードを開始する
- リクエストには `model_id` を指定する
- 対応モデル以外のIDが指定された場合はエラーを返す

### FR-4: URL登録機能の廃止

- `POST /v0/models/register` エンドポイントを廃止する
- `POST /v0/models/discover-gguf` エンドポイントを廃止する
- ダッシュボードの「Register」ダイアログを削除する

### FR-5: OpenAI互換API維持

- `GET /v1/models` は従来通り利用可能なモデルのみを返す
- ダウンロード中や未ダウンロードのモデルは含まない

## 非機能要件

### NFR-1: パフォーマンス

- モデル一覧APIのレスポンス時間: 500ms以内
- HF動的情報のキャッシュTTL: 10分

### NFR-2: 可用性

- HF APIが利用不可の場合でも静的情報でモデル一覧を返す

## UI/UX要件

### タブ構成

- 「Local」タブ: ダウンロード済みモデル一覧
- 「Model Hub」タブ: 対応モデル一覧（デフォルト表示）

### カード表示

- モデル名（大きく）
- 説明（1-2行）
- サイズ / 必要VRAM
- ダウンロード数 / スター数（HFから取得）
- 状態に応じたアクションボタン

## 依存関係

- SPEC-11106000（HuggingFace URL登録）を置き換え
- SPEC-dcaeaec4（モデルストレージ）のダウンロード機能を利用

## 除外事項

- カスタムモデル登録機能（対応モデル以外の登録）
- モデルの自動更新機能
- モデルバージョン管理
