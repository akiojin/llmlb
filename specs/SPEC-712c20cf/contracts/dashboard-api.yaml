openapi: 3.0.0
info:
  title: Ollama Coordinator Dashboard API
  description: ダッシュボード用API - エージェント一覧、システム統計、リアルタイム監視
  version: 1.0.0
  contact:
    name: Ollama Coordinator Project
  license:
    name: MIT

servers:
  - url: http://localhost:8080
    description: ローカル開発環境
  - url: http://coordinator:8080
    description: 本番環境

paths:
  /api/dashboard/agents:
    get:
      summary: エージェント一覧取得
      description: 登録されたすべてのエージェント情報を取得する
      operationId: getAgents
      tags:
        - Dashboard
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Agent'
              examples:
                multipleAgents:
                  summary: 複数エージェントの例
                  value:
                    - id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                      hostname: "server-01"
                      ip_address: "192.168.1.10"
                      ollama_version: "0.1.23"
                      status: "Online"
                      last_heartbeat: "2025-10-31T12:00:00Z"
                      registered_at: "2025-10-30T10:00:00Z"
                    - id: "b2c3d4e5-f6a7-8901-bcde-f12345678901"
                      hostname: "server-02"
                      ip_address: "192.168.1.11"
                      ollama_version: "0.1.23"
                      status: "Offline"
                      last_heartbeat: "2025-10-31T11:50:00Z"
                      registered_at: "2025-10-30T11:00:00Z"
        '500':
          description: サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/dashboard/stats:
    get:
      summary: システム統計情報取得
      description: 登録エージェント数、オンライン数、オフライン数などの統計情報を取得する
      operationId: getStats
      tags:
        - Dashboard
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStats'
              examples:
                basicStats:
                  summary: 基本統計（Phase 1）
                  value:
                    total_agents: 5
                    online_agents: 3
                    offline_agents: 2
                fullStats:
                  summary: 完全統計（Phase 3）
                  value:
                    total_agents: 5
                    online_agents: 3
                    offline_agents: 2
                    total_requests: 1523
                    avg_response_time_ms: 45.2
                    error_count: 3
        '500':
          description: サーバーエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /dashboard:
    get:
      summary: ダッシュボード画面表示
      description: HTML ダッシュボード画面を返す（静的ファイル配信）
      operationId: getDashboard
      tags:
        - Dashboard
      responses:
        '200':
          description: HTML返却
          content:
            text/html:
              schema:
                type: string
                example: |
                  <!DOCTYPE html>
                  <html>
                  <head>
                    <title>Ollama Coordinator Dashboard</title>
                  </head>
                  <body>
                    <h1>Dashboard</h1>
                  </body>
                  </html>
        '404':
          description: ファイル未発見
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Agent:
      type: object
      required:
        - id
        - hostname
        - ip_address
        - ollama_version
        - status
        - last_heartbeat
        - registered_at
      properties:
        id:
          type: string
          format: uuid
          description: エージェントの一意識別子（UUID）
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        hostname:
          type: string
          description: ホスト名
          example: "server-01"
          minLength: 1
        ip_address:
          type: string
          description: IPアドレス（IPv4またはIPv6）
          example: "192.168.1.10"
          pattern: '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$|^(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}$'
        ollama_version:
          type: string
          description: Ollamaのバージョン
          example: "0.1.23"
          minLength: 1
        status:
          type: string
          enum: [Online, Offline]
          description: エージェントの現在ステータス
          example: "Online"
        last_heartbeat:
          type: string
          format: date-time
          description: 最後のハートビート受信時刻（ISO 8601形式）
          example: "2025-10-31T12:00:00Z"
        registered_at:
          type: string
          format: date-time
          description: エージェント登録時刻（ISO 8601形式）
          example: "2025-10-30T10:00:00Z"

    DashboardStats:
      type: object
      required:
        - total_agents
        - online_agents
        - offline_agents
      properties:
        total_agents:
          type: integer
          format: int32
          description: 登録エージェント総数
          example: 5
          minimum: 0
        online_agents:
          type: integer
          format: int32
          description: オンラインエージェント数
          example: 3
          minimum: 0
        offline_agents:
          type: integer
          format: int32
          description: オフラインエージェント数
          example: 2
          minimum: 0
        total_requests:
          type: integer
          format: int64
          description: 総リクエスト処理数（Phase 3で実装、現在はnull）
          nullable: true
          example: 1523
          minimum: 0
        avg_response_time_ms:
          type: number
          format: double
          description: 平均レスポンスタイム（ミリ秒、Phase 3で実装、現在はnull）
          nullable: true
          example: 45.2
          minimum: 0.0
        error_count:
          type: integer
          format: int64
          description: エラー総数（Phase 3で実装、現在はnull）
          nullable: true
          example: 3
          minimum: 0

    Error:
      type: object
      required:
        - error
        - timestamp
      properties:
        error:
          type: string
          description: エラーメッセージ
          example: "Internal server error"
        details:
          type: string
          description: 詳細な説明（オプション）
          example: "Failed to read agents from storage"
        timestamp:
          type: string
          format: date-time
          description: エラー発生時刻（ISO 8601形式）
          example: "2025-10-31T12:00:00Z"

tags:
  - name: Dashboard
    description: ダッシュボード関連API
