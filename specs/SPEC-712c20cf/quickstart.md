# 管理ダッシュボード クイックスタート

**SPEC-ID**: SPEC-712c20cf
**日付**: 2025-10-31

## 前提条件

- ✅ Rust 1.75+ がインストールされている
- ✅ Ollama Coordinator が実装済み（SPEC-94621a1f, SPEC-63acef08, SPEC-443acc8c）
- ✅ 少なくとも1つのOllamaエージェントが利用可能

## ダッシュボードアクセス手順

### 1. コーディネーター起動

```bash
# リポジトリルートから
cd /ollama-coordinator
cargo run --bin coordinator
```

**期待される出力**:
```
INFO coordinator: Starting Ollama Coordinator on 0.0.0.0:8080
INFO coordinator: Dashboard available at http://localhost:8080/dashboard
INFO coordinator: API endpoints registered
```

### 2. エージェント登録（既にエージェントがない場合）

別のターミナルでエージェントを起動:
```bash
# エージェント側で実行
ollama-coordinator-agent --coordinator http://localhost:8080
```

**期待される出力**:
```
INFO agent: Registered with coordinator: agent-abc123
INFO agent: Sending heartbeat every 30s
```

### 3. ダッシュボードにアクセス

ブラウザで以下のURLを開く:
```
http://localhost:8080/dashboard
```

**期待される表示**:
- ページタイトル: "Ollama Coordinator Dashboard"
- システム統計カード:
  - 登録エージェント総数: 1
  - オンラインエージェント数: 1
  - オフラインエージェント数: 0
- エージェント一覧テーブル:
  - ID, ホスト名, IPアドレス, Ollamaバージョン, ステータス, 最終確認時刻

### 4. リアルタイム更新確認

ダッシュボードを表示したまま、別のターミナルで2つ目のエージェントを起動:
```bash
ollama-coordinator-agent --coordinator http://localhost:8080
```

**期待される動作**:
- 5秒以内に自動的に画面が更新される
- 登録エージェント総数が 2 に増加
- エージェント一覧に新しいエージェントが追加される

## テストシナリオ

### シナリオ1: 基本アクセス

**目的**: ダッシュボードが正常に表示されることを確認

| ステップ | アクション | 期待される結果 |
|---------|-----------|--------------|
| 1 | コーディネーターを起動 | サーバーが http://localhost:8080 で起動 |
| 2 | ブラウザで http://localhost:8080/dashboard にアクセス | ダッシュボードが表示される |
| 3 | ページが完全にロードされる | エージェント一覧とシステム統計が表示される |

**成功基準**:
- HTTPステータスコード 200
- ページタイトルが "Ollama Coordinator Dashboard"
- JavaScriptエラーなし（ブラウザコンソール確認）

### シナリオ2: エージェント一覧表示

**目的**: 登録されたエージェントが一覧に表示されることを確認

| ステップ | アクション | 期待される結果 |
|---------|-----------|--------------|
| 1 | エージェントを1つ登録 | エージェントが登録される |
| 2 | ダッシュボードにアクセス | エージェント一覧に1行表示される |
| 3 | 表示内容を確認 | マシン名、IPアドレス、Ollamaバージョン、ステータス（オンライン）、最終確認時刻が表示される |

**成功基準**:
- エージェント数: 1
- ステータス: Online（緑色）
- すべてのカラムにデータが表示される

### シナリオ3: リアルタイム更新

**目的**: ページリロードなしで自動更新されることを確認

| ステップ | アクション | 期待される結果 |
|---------|-----------|--------------|
| 1 | ダッシュボードを表示 | 初期状態が表示される |
| 2 | 5秒待機 | 何も変化しない（同じデータ） |
| 3 | 新しいエージェントを登録 | - |
| 4 | 5秒待機 | ページリロードなしで新しいエージェントが表示される |

**成功基準**:
- 更新間隔: 5秒
- ページリロード不要
- ネットワークタブでポーリングリクエスト確認可能

### シナリオ4: オフライン検出

**目的**: エージェントがオフラインになったことを検出できることを確認

| ステップ | アクション | 期待される結果 |
|---------|-----------|--------------|
| 1 | オンラインエージェントを確認 | ステータスが "Online" |
| 2 | エージェントを停止 | エージェントプロセスが終了 |
| 3 | 60秒待機 | ヘルスチェックがタイムアウト |
| 4 | ダッシュボードを確認 | ステータスが "Offline" に変わる（赤色） |

**成功基準**:
- タイムアウト: 60秒
- ステータス変化: Online → Offline
- 色変化: 緑 → 赤

### シナリオ5: システム統計

**目的**: システム統計が正しく計算されることを確認

| ステップ | アクション | 期待される結果 |
|---------|-----------|--------------|
| 1 | エージェント3台登録（すべてオンライン） | 登録数: 3, オンライン: 3, オフライン: 0 |
| 2 | 1台をオフラインにする | 登録数: 3, オンライン: 2, オフライン: 1 |
| 3 | さらに1台を追加 | 登録数: 4, オンライン: 3, オフライン: 1 |

**成功基準**:
- 合計 = オンライン + オフライン（不変条件）
- 統計が5秒以内に更新される

### シナリオ6: モバイルレスポンシブ

**目的**: モバイルデバイスで表示できることを確認

| ステップ | アクション | 期待される結果 |
|---------|-----------|--------------|
| 1 | ブラウザのデベロッパーツールを開く | - |
| 2 | デバイスツールバーを有効化 | - |
| 3 | iPhone SE (375x667) を選択 | レイアウトがモバイル用に変化 |
| 4 | スクロールして全体を確認 | すべてのコンテンツが表示される |

**成功基準**:
- 横スクロールなし
- テキストが読みやすいサイズ
- ボタン・リンクがタップ可能なサイズ

## トラブルシューティング

### ダッシュボードにアクセスできない

**症状**: http://localhost:8080/dashboard が開かない

**原因と対処**:
1. **コーディネーターが起動していない**
   - `cargo run --bin coordinator` を実行
   - ログで "Starting Ollama Coordinator" を確認

2. **ポート8080が使用中**
   - `lsof -i :8080` で確認
   - 別のポートを使用: `COORDINATOR_PORT=9090 cargo run --bin coordinator`

3. **ファイアウォールでブロック**
   - ファイアウォール設定を確認
   - ローカルホストアクセスを許可

### エージェントが表示されない

**症状**: エージェント一覧が空

**原因と対処**:
1. **エージェントが登録されていない**
   - `curl http://localhost:8080/api/agents` で確認
   - エージェントを起動

2. **API エンドポイントエラー**
   - ブラウザコンソールでエラー確認
   - ネットワークタブで `/api/dashboard/agents` のレスポンス確認

### 自動更新が動作しない

**症状**: 新しいエージェントを追加しても表示が更新されない

**原因と対処**:
1. **JavaScriptエラー**
   - ブラウザコンソールでエラー確認
   - Chart.js がロードされているか確認

2. **ポーリング停止**
   - ネットワークタブで定期的なリクエスト確認
   - ページをリロードして再開

## パフォーマンス検証

### 初回ロード時間

```bash
# Lighthouseで測定
npx lighthouse http://localhost:8080/dashboard --only-categories=performance
```

**目標**: Performance Score > 90, First Contentful Paint < 2秒

### ポーリング負荷

```bash
# 10人の管理者を想定
# 5秒間隔 × 10人 = 2 req/s
ab -n 100 -c 10 http://localhost:8080/api/dashboard/agents
```

**目標**: 平均応答時間 < 50ms

## 次のステップ

1. **Phase 2**: WebSocket統合（将来）
2. **Phase 3**: メトリクス可視化（CPU、メモリグラフ）
3. **Phase 4**: エージェント詳細ビュー、フィルタリング＆検索

## 関連ドキュメント

- [機能仕様書](./spec.md)
- [実装計画](./plan.md)
- [データモデル](./data-model.md)
- [API契約](./contracts/dashboard-api.yaml)
