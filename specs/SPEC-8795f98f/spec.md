# 機能仕様書: ダッシュボード Modelsタブ＆エンドポイント詳細モーダル改善

**機能ID**: `SPEC-8795f98f`
**作成日**: 2026-02-16
**ステータス**: 下書き
**入力**: ユーザー説明: "ダッシュボードにModelsタブを追加し全エンドポイントのモデルを横断的に閲覧できるビューを提供する。エンドポイント詳細モーダルの見切れ問題を修正する。"

## ユーザーシナリオ＆テスト *(必須)*

### ユーザーストーリー1 - モデル一覧の横断閲覧 (優先度: P1)

運用者として、全エンドポイントに登録されたモデルをモデルID単位で
一覧表示し、どのモデルがどのエンドポイントで利用可能かを一目で把握したい。
現在はEndpointsタブで各エンドポイントを個別に開かないとモデル情報を確認できず、
複数エンドポイントに同一モデルが存在する場合の全体像が見えない。

**この優先度の理由**: モデル横断ビューは本機能の核心であり、
これなしでは他の機能（フィルタ、Playground連携等）が成立しない。

**独立テスト**: Modelsタブを開き、全エンドポイントのモデルが
モデルID単位で集約表示されることを確認するだけで独立してテスト可能。
モデル一覧が見えるだけでも既存UIにない価値を提供する。

**受け入れシナリオ**:

1. **前提** ダッシュボードにログイン済みでエンドポイントが1つ以上登録されている、
   **実行** Modelsタブをクリックする、
   **結果** 全エンドポイントの登録済みモデルがモデルID単位で集約されたテーブルが表示される
2. **前提** 同一モデルID（例: llama-3）が複数エンドポイントに存在する、
   **実行** Modelsタブを開く、
   **結果** そのモデルIDは1行に集約され、ステータスは最良のもの
   （registered > caching > pending > error）が表示される
3. **前提** モデル一覧が表示されている、
   **実行** モデル行のアコーディオンを展開する、
   **結果** そのモデルを提供する各エンドポイントの名前・ステータス・
   リクエスト統計・Playground直リンクが表示される
4. **前提** エンドポイントが1つも登録されていない、
   **実行** Modelsタブを開く、
   **結果** 「モデルが登録されていません」という空状態メッセージが表示される

---

### ユーザーストーリー2 - モデルの検索・フィルタ・ソート (優先度: P1)

運用者として、モデル数が多い場合でも目的のモデルを素早く見つけたい。
テキスト検索、capabilities絞込、lifecycle\_status絞込、
カラムソートを組み合わせて効率的にモデルを探索できる。

**この優先度の理由**: モデル数が増えると一覧だけでは実用に耐えない。
検索・フィルタはP1のモデル一覧と同時に提供しないと実用価値が大幅に低下する。

**独立テスト**: モデル一覧が表示された状態で、
テキスト検索・フィルタ・ソートの各操作が正しく機能することを確認できる。

**受け入れシナリオ**:

1. **前提** モデル一覧に複数モデルが表示されている、
   **実行** テキスト検索欄にモデル名の一部を入力する、
   **結果** model\_idに部分一致するモデルのみが表示される
2. **前提** モデル一覧が表示されている、
   **実行** capabilitiesフィルタで「chat」を選択する、
   **結果** chat機能を持つモデルのみが表示される
3. **前提** モデル一覧が表示されている、
   **実行** lifecycle\_statusフィルタで「error」を選択する、
   **結果** エラー状態のモデルのみが表示される
4. **前提** モデル一覧が表示されている、
   **実行** size\_bytesカラムヘッダーをクリックする、
   **結果** モデルサイズの昇順/降順でソートされる
5. **前提** テキスト検索とcapabilitiesフィルタを同時に適用している、
   **実行** lifecycle\_statusフィルタも追加する、
   **結果** 3つの条件をすべて満たすモデルのみが表示される

---

### ユーザーストーリー3 - カラム表示カスタマイズ (優先度: P2)

運用者として、テーブルに表示するカラムを自分の用途に合わせて
選択し、必要な情報だけを効率的に確認したい。

**この優先度の理由**: フル情報カラムは14項目あり全表示すると横幅が足りない。
カラム制御がないと情報過多で視認性が低下するが、
デフォルトカラムのみでもP1の価値は損なわれないためP2とする。

**独立テスト**: カラム表示/非表示の切り替えUIを操作し、
テーブルのカラムが動的に増減することを確認できる。

**受け入れシナリオ**:

1. **前提** Modelsタブが表示されている、
   **実行** カラム設定UIを開く、
   **結果** 全カラムのチェックボックス一覧が表示され、
   デフォルトではmodel\_id/lifecycle\_status/ready/capabilities/size\_bytes/owned\_byが
   チェック済みである
2. **前提** カラム設定UIが開いている、
   **実行** descriptionカラムのチェックを入れる、
   **結果** テーブルにdescriptionカラムが追加表示される
3. **前提** descriptionカラムが表示されている、
   **実行** descriptionカラムのチェックを外す、
   **結果** テーブルからdescriptionカラムが非表示になる

---

### ユーザーストーリー4 - ModelsタブからPlaygroundへの遷移 (優先度: P2)

運用者として、モデル一覧で見つけたモデルを即座にPlaygroundで
試用したい。モデル行からワンクリックでLB Playgroundへ遷移し、
そのモデルが自動選択された状態で推論テストを開始できる。

**この優先度の理由**: Playground連携はモデル選択後の自然な次アクションだが、
モデル一覧の閲覧・検索だけでも十分な価値があるためP2とする。

**独立テスト**: モデル行のPlaygroundボタンをクリックし、
LB Playgroundへ遷移後にそのモデルが自動選択されていることを確認できる。

**受け入れシナリオ**:

1. **前提** Modelsタブでモデル一覧が表示されている、
   **実行** 任意のモデル行のPlaygroundボタンをクリックする、
   **結果** LB Playgroundに遷移し、クリックしたモデルがモデル選択欄に
   自動選択される
2. **前提** アコーディオン展開で特定エンドポイントの情報が表示されている、
   **実行** そのエンドポイントのPlaygroundリンクをクリックする、
   **結果** そのエンドポイント専用のPlaygroundに遷移する
3. **前提** lifecycle\_statusがerrorのモデル行が表示されている、
   **実行** そのモデルのPlaygroundボタンを確認する、
   **結果** ready=falseのモデルではPlaygroundボタンが非活性になっている

---

### ユーザーストーリー5 - エンドポイント詳細モーダルのスクロール対応 (優先度: P1)

運用者として、エンドポイント詳細モーダルを開いたときに
コンテンツ全体を上下スクロールして確認したい。
現在はモーダル内のコンテンツ（Daily Requests、Models、
Requests by Model等）が画面外にはみ出して見切れており、
下部のセクションにアクセスできない。

**この優先度の理由**: 既存機能のバグ修正であり、運用者が
エンドポイントの詳細情報を確認できない深刻な問題。
新機能より優先して修正すべき。

**独立テスト**: エンドポイント詳細モーダルを開き、
全セクション（統計カード・チャート・モデル一覧・設定フォーム）を
スクロールして確認できることをテストできる。

**受け入れシナリオ**:

1. **前提** 小さいビューポート（高さ768px以下）でダッシュボードを表示している、
   **実行** エンドポイントの詳細ボタンをクリックする、
   **結果** モーダルが表示され、コンテンツ部分がスクロール可能で、
   ヘッダー（エンドポイント名）とフッター（Save/Close）は固定表示される
2. **前提** エンドポイント詳細モーダルが開いている、
   **実行** コンテンツを最下部までスクロールする、
   **結果** 編集セクション（Display Name、Health Check Interval、
   Inference Timeout、Notes）が完全に表示され操作できる

---

### エッジケース

- エンドポイントが全てオフラインの場合、モデル一覧にはモデルが表示されないか？
  → 登録済みモデルは表示される（lifecycle\_statusで状態を判別可能）
- 同一モデルIDでcapabilitiesが異なるエンドポイントが存在する場合は？
  → 集約行では全エンドポイントのcapabilitiesの和集合を表示する
- モデル数が0の場合のModelsタブは？
  → 空状態メッセージを表示する
- 手動リフレッシュ中にエンドポイントが追加/削除された場合は？
  → リフレッシュ完了時点のデータが反映される
- アコーディオン展開中にエンドポイントがオフラインになった場合は？
  → 展開済みのデータはそのまま表示され、次回リフレッシュで更新される
- カラム表示/非表示の設定は永続化されるか？
  → 初期リリースではセッション内のみ保持（ページリロードでデフォルトに戻る）
- LB Playgroundへの遷移時に指定したモデルが存在しなくなっていた場合は？
  → Playgroundは通常通り表示され、モデル選択欄はデフォルト状態になる

## 要件 *(必須)*

### 機能要件

- **FR-001**: ダッシュボードにModelsタブを追加し、
  Endpointsタブの次（2番目）に配置する
  （Endpoints | Models | Statistics | History | Logs）
- **FR-002**: Modelsタブは全エンドポイントの登録済みモデルを
  モデルID単位で集約してテーブル表示する
- **FR-003**: 同一モデルIDが複数エンドポイントに存在する場合、
  ステータスは最良のもの（registered > caching > pending > error）を表示し、
  capabilitiesは全エンドポイントの和集合を表示する
- **FR-004**: テーブルのカラムとしてmodel\_id, lifecycle\_status, ready,
  capabilities, size\_bytes, max\_tokens, owned\_by, source, tags,
  description, repo, filename, required\_memory\_bytes, chat\_templateを
  サポートする
- **FR-005**: デフォルト表示カラムはmodel\_id, lifecycle\_status, ready,
  capabilities, size\_bytes, owned\_byとし、他カラムは非表示とする
- **FR-006**: ユーザーがカラムの表示/非表示をチェックボックスで
  切り替えられるUIを提供する
- **FR-007**: capabilitiesはアイコンバッジで表示し、
  ホバー時にツールチップで名称を表示する
- **FR-008**: lifecycle\_statusは色分けして表示する
  （緑=registered、黄=pending/caching、赤=error）
- **FR-009**: サイズ（size\_bytes, required\_memory\_bytes）は
  人間が読みやすい形式（例: 4.2 GB）で表示する
- **FR-010**: モデル行をクリック/展開すると、そのモデルを提供する
  各エンドポイントの詳細情報（エンドポイント名、ステータス、
  リクエスト統計、Playground直リンク）がアコーディオン形式で表示される
- **FR-011**: アコーディオン展開時のエンドポイント別統計データは
  展開操作時にオンデマンドで取得する
- **FR-012**: model\_idのテキスト検索機能を提供する
- **FR-013**: capabilitiesによるチェックボックス形式のフィルタを提供する
  （chat, completion, embedding, vision等）
- **FR-014**: lifecycle\_statusによるフィルタを提供する
  （pending, caching, registered, error）
- **FR-015**: カラムヘッダークリックによるソート機能を提供する
- **FR-016**: 自動ポーリングは行わず、手動リフレッシュボタンを提供する
- **FR-017**: モデル行からLB Playgroundへの遷移ボタンを提供し、
  URLパラメータでモデルIDを渡す
- **FR-018**: LB Playgroundは URLパラメータからモデルIDを受け取り、
  モデル選択欄を自動選択する
- **FR-019**: アコーディオン展開内の各エンドポイント行から
  Endpoint Playgroundへの直リンクを提供する
- **FR-020**: エンドポイント詳細モーダルのコンテンツ部分に
  スクロール機能を追加し、ヘッダー・フッターは固定表示とする
- **FR-021**: エンドポイント詳細モーダルのコンテンツ高さは
  ビューポート高さに応じて動的に調整される
- **FR-022**: Endpointsタブの既存のモデル表示機能はそのまま維持する
  （Modelsタブとの重複は許容する）

### 主要エンティティ

- **集約モデル（AggregatedModel）**: 同一モデルIDを持つ
  全エンドポイントの情報を集約した表示用エンティティ。
  モデルID、最良ステータス、capabilities和集合、
  提供エンドポイント数、各種メタデータを含む
- **エンドポイント別モデル情報**: 特定エンドポイントにおける
  モデルの詳細情報。個別のステータス、capabilities、
  リクエスト統計を含む
- **リクエスト統計**: エンドポイント×モデルの組み合わせにおける
  成功数・失敗数・平均レイテンシ

## 成功基準 *(必須)*

### 測定可能な結果

- **SC-001**: Modelsタブを開いてから全モデル一覧が表示されるまで
  3秒以内に完了する（100モデル以下の環境）
- **SC-002**: テキスト検索・フィルタ操作の結果がUIに反映されるまで
  200ms以内（クライアントサイドフィルタリング）
- **SC-003**: エンドポイント詳細モーダルが全ビューポートサイズ
  （768px以上）で全セクションがスクロールで閲覧可能
- **SC-004**: Modelsタブのカラム表示/非表示切替が即座に
  テーブルに反映される（再レンダリング200ms以内）
- **SC-005**: ModelsタブからPlaygroundへの遷移が1クリックで完了し、
  モデルが自動選択された状態で表示される
